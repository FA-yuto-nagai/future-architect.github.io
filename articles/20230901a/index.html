<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <!--
    ███████╗██╗░░░██╗████████╗██╗░░░██╗██████╗░███████╗
    ██╔════╝██║░░░██║╚══██╔══╝██║░░░██║██╔══██╗██╔════╝
    █████╗░░██║░░░██║░░░██║░░░██║░░░██║██████╔╝█████╗░░
    ██╔══╝░░██║░░░██║░░░██║░░░██║░░░██║██╔══██╗██╔══╝░░
    ██║░░░░░╚██████╔╝░░░██║░░░╚██████╔╝██║░░██║███████╗
    ╚═╝░░░░░░╚═════╝░░░░╚═╝░░░░╚═════╝░╚═╝░░╚═╝╚══════╝
    ████████╗███████╗░█████╗░██╗░░██╗
    ╚══██╔══╝██╔════╝██╔══██╗██║░░██║
    ░░░██║░░░█████╗░░██║░░╚═╝███████║
    ░░░██║░░░██╔══╝░░██║░░██╗██╔══██║
    ░░░██║░░░███████╗╚█████╔╝██║░░██║
    ░░░╚═╝░░░╚══════╝░╚════╝░╚═╝░░╚═╝
    ██████╗░██╗░░░░░░█████╗░░██████╗░
    ██╔══██╗██║░░░░░██╔══██╗██╔════╝░
    ██████╦╝██║░░░░░██║░░██║██║░░██╗░
    ██╔══██╗██║░░░░░██║░░██║██║░░╚██╗
    ██████╦╝███████╗╚█████╔╝╚██████╔╝
    ╚═════╝░╚══════╝░╚════╝░░╚═════╝░
    Welcome engineer.
    https://www.future.co.jp/recruit/
  -->
  
  <title>UnityのShaderでVRプラネタリウムを作ったけどうまくいかず悔しかったので自作の星を作ったら宇宙が終わった | フューチャー技術ブログ</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  <meta name="description" content="はじめにこんにちは。TIG DX ユニット所属、金欠コンサルタントの藤井です。 夏の自由研究連載の第2弾です。夏休みの宿題っぽいものを題材にしてみました。 実は私、星を見るのが好きなので、天体望遠鏡を買ったり、星を撮るためにカメラを買ったりしています。せっかくならいい環境で見たいので、南は沖縄から北は北海道まで星を見に行っています。（海外も行きたい）。ただ、星を見に行くとなるとどうしても長距離移動">
<meta property="og:type" content="article">
<meta property="og:title" content="UnityのShaderでVRプラネタリウムを作ったけどうまくいかず悔しかったので自作の星を作ったら宇宙が終わった | フューチャー技術ブログ">
<meta property="og:url" content="https://future-architect.github.io/articles/20230901a/index.html">
<meta property="og:site_name" content="フューチャー技術ブログ">
<meta property="og:description" content="はじめにこんにちは。TIG DX ユニット所属、金欠コンサルタントの藤井です。 夏の自由研究連載の第2弾です。夏休みの宿題っぽいものを題材にしてみました。 実は私、星を見るのが好きなので、天体望遠鏡を買ったり、星を撮るためにカメラを買ったりしています。せっかくならいい環境で見たいので、南は沖縄から北は北海道まで星を見に行っています。（海外も行きたい）。ただ、星を見に行くとなるとどうしても長距離移動">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://future-architect.github.io/images/20230901a/image.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230901a/image_2.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230901a/texture3.9_2.5.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230901a/image_3.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230901a/image_4.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230901a/output.gif">
<meta property="og:image" content="https://future-architect.github.io/images/20230901a/image_5.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230901a/output2.gif">
<meta property="article:published_time" content="2023-08-31T15:00:00.000Z">
<meta property="article:modified_time" content="2023-10-02T00:07:27.503Z">
<meta property="article:tag" content="Unity">
<meta property="article:tag" content="VR">
<meta property="article:tag" content="Shader">
<meta property="article:tag" content="プラネタリウム">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://future-architect.github.io/images/20230901a/image.png">
  
  <link rel="alternate" href="/atom.xml" title="フューチャー技術ブログ" type="application/atom+xml">
  
  <link rel="icon" href="/logo.svg" sizes="any" type="image/svg+xml">
  <link rel="mask-icon" href="/logo.svg" sizes="any" color="#0bd">
  <link rel="icon alternate" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes='180x180' href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes='57x57' href="/apple-touch-icon-57x57.png">
  <link rel="canonical" href="https://future-architect.github.io/articles/20230901a/">
  <meta content="Unity,VR,Shader,プラネタリウム" name="keywords">
  <meta content="藤井亮佑" name="author">
  <link rel="preload" as="image" href="/banner.jpg" />
  <link rel='manifest' href='/manifest.webmanifest'/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <link rel="stylesheet" href="/metronic/assets/style.css">
  <link rel="stylesheet" href="/css/theme-styles.css">
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="corporate">
  <div class="wrap" itemscope itemtype="https://schema.org/TechArticle">
  <!-- BEGIN HEADER -->
<header class="header">
	<div class="header-overlay">
		<div class="header-menu"></div>
		<div class="header-title"><a href="/">Future Tech Blog</a></div>
		<div class="header-title-sub">フューチャー技術ブログ</div>
	</div>
</header>
<!-- Header END -->

  <div class="container">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/articles/">Blog</a></li>
    <li class="active">Post</li>
  </ul>
  <section id="main" class="margin-top-30">
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programmingカテゴリ</a>
  </div>


    <h2 itemprop="name" class="article-title">UnityのShaderでVRプラネタリウムを作ったけどうまくいかず悔しかったので自作の星を作ったら宇宙が終わった
  
  <a target="_blank" rel="noopener" href="https://github.com/future-architect/tech-blog/edit/master/source/_posts/20230901a_UnityのShaderでVRプラネタリウムを作ったけどうまくいかず悔しかったので自作の星を作ったら宇宙が終わった.md" title="Suggest Edits" class="github-edit"><i class="github-edit-icon"></i></a>
  
</h2>

    <div class="row">
  <main class="col-md-9 blog-posts">
    <article id="post-20230901a_UnityのShaderでVRプラネタリウムを作ったけどうまくいかず悔しかったので自作の星を作ったら宇宙が終わった" class="article article-type-post blog-item" itemscope itemprop="blogPost">
      <div class="article-inner">
        
        <header class="article-header">
          <ul class="blog-info">
            <li class="blog-info-item"><a href="/articles/2023/" class="publish-date"><time datetime="2023-08-31T15:00:00.000Z" itemprop="datePublished">2023.09.01</time></a>
</li>
            <li class="blog-info-item"><li><a href="/authors/%E8%97%A4%E4%BA%95%E4%BA%AE%E4%BD%91" title="藤井亮佑さんの記事一覧へ" class="post-author">藤井亮佑</a></li></li>
            <li class="blog-info-item">
  
    
    <a href="/tags/Unity/" title="Unityタグの記事へ" class="tag-list-link">Unity</a>
  
    
    <a href="/tags/VR/" title="VRタグの記事へ" class="tag-list-link">VR</a>
  
    
    <a href="/tags/Shader/" title="Shaderタグの記事へ" class="tag-list-link">Shader</a>
  
    
    <a href="/tags/プラネタリウム/" title="プラネタリウムタグの記事へ" class="tag-list-link">プラネタリウム</a>
  

</li>
          </ul>
          </header>
        
        <div class="article-entry" itemprop="articleBody">
          
            <h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>こんにちは。TIG DX ユニット所属、金欠コンサルタントの藤井です。</p>
<p><a href="/articles/20230821a/">夏の自由研究連載</a>の第2弾です。夏休みの宿題っぽいものを題材にしてみました。</p>
<p>実は私、星を見るのが好きなので、天体望遠鏡を買ったり、星を撮るためにカメラを買ったりしています。せっかくならいい環境で見たいので、南は沖縄から北は北海道まで星を見に行っています。（海外も行きたい）。ただ、星を見に行くとなるとどうしても長距離移動になるので、お金もかかるし大変です。天気に左右されるのもつらいところです。</p>
<p>ということで今回は、遠出しなくてもいろんな星を見ることができるように、VR でプラネタリウムを作ろうと思います。</p>
<p>なお、本記事では Unity そのものの機能や、Shader の基本的な部分には触れず、作成したソースを参照しながら、重要な部分のみを詳細に記載しています。</p>
<h2 id="事前準備等"><a href="#事前準備等" class="headerlink" title="事前準備等"></a>事前準備等</h2><h3 id="大方針"><a href="#大方針" class="headerlink" title="大方針"></a>大方針</h3><p>VR プラネタリウムを作るためには、VR 空間上で星の配置を再現していく必要があります。実現方針としては概ね以下の 2 つに分かれるかと思います。</p>
<ol>
<li>実際に宇宙空間を作成し、星をオブジェクトとして配置していく<ul>
<li>メリット：非常にわかりやすく、実装コストが低い。</li>
<li>デメリット：大量のオブジェクトを作成することになるため、負荷が高い。</li>
</ul>
</li>
<li>天球を作成し、天球上に星の絵（テクスチャ）を描く<ul>
<li>メリット：オブジェクトは天球のみのため、負荷が低い。</li>
<li>デメリット：テクスチャの解像度に依存して厳密性が低下する。</li>
</ul>
</li>
</ol>
<p>ところで皆さんは宇宙にどれぐらいの星（恒星）があるかご存知でしょうか。星の数ほど、というぐらいなので途方もない数であるということはイメージできると思います。結論としては、宇宙の大きさが無限大なので、星の数も無限大です。とはいえ、我々が地球から観測できる星の数は有限であるため、十分な観測技術があれば星の数を数えることは原理上は可能なはずです。（現在確認可能な範囲でも数十億個はあると言われています。）</p>
<p>この観測できる星をすべて網羅した、星表と呼ばれるものを作りたい、という野望を天文学者は古より抱いており、紀元前から現代に至るまで様々な星表が作られてきました。ただ、これらの星表はもちろん完璧なものではなく、実際に記載されているのは数十万程度です。</p>
<p>母数が多いので、数十万と聞くと少なく見えますが、決して小さい値ではありません。特に今回は Meta Quest 2 を用いてプラネタリウムを作ろうと思っているので、マシンスペックもそこまで高くありません。そのため今回は、負荷を低減できる方針 2 を採用します。</p>
<h2 id="Shader-で-Skybox-に動的に星を描いてみる"><a href="#Shader-で-Skybox-に動的に星を描いてみる" class="headerlink" title="Shader で Skybox に動的に星を描いてみる"></a>Shader で Skybox に動的に星を描いてみる</h2><p>では、天球上に星を描いてみましょう。ただし今回は天球用のオブジェクトは作成せず、Skybox と呼ばれるものを使います。Unity にデフォルトで用意されている、オブジェクトが存在しなければ描画される背景のようなもので、ゲーム空間を取り囲むように配置されています。</p>
<p>Skybox に星の絵を描くに当たり、実際に星空のテクスチャを描いて貼り付けても良いのですが、今回は Shader で動的に星景を作成することにしてみました。理由は Shader を書いてみたかったからです。</p>
<p>Unity では、「ゲーム空間内の<code>(x,y,z)</code>という座標に hoge というオブジェクトが有るから、画面上の<code>(X,Y)</code>座標のピクセルには<code>(r,g,b)</code>という色を出力しよう」という処理を Shader と呼ばれるものが行っています。<br>つまり Shader に適切な指示を出してもらえば、実態としてはゲーム空間内に何も存在していないにも関わらず、画面上には何かが表示されている、ということができます。</p>
<p>これにより、単純にゲーム空間内に召喚するオブジェクトが減るという効果はもちろんあるのですが、それに加えて Unity では、C#で書かれたロジックは CPU で（ほぼ）直列に処理がされ、Shader は GPU で並列に処理がされます。基本的に描写する対象の数が多いほど、処理の並列度が重要になってくるため、星の表示はすべて Shader にまかせてしまえば、非常に軽快に宇宙を再現できるのではないか、という気がしてきました。<br>なお、結論から記載すると、これはダメでした。</p>
<h3 id="Shader-を書いてみる"><a href="#Shader-を書いてみる" class="headerlink" title="Shader を書いてみる"></a>Shader を書いてみる</h3><p>Unity の Shader では、HLSL と呼ばれる言語を用いて処理を記述していきます。</p>
<p>とりあえず試しに 2 つ、白と赤の星が表示されるようなものを作ってみたものが<a target="_blank" rel="noopener" href="https://github.com/shomuMatch/VRPlanetarium/blob/master/Assets/Shader/sample1.shader">こちらの sample1.shader</a>です。</p>
<p>重要なのは以下のあたりです。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 星の存在する方向や色、明るさを定義</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> Star stars[<span class="number">2</span>] = &#123;</span><br><span class="line">      createStar(float3(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), fixed3(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="number">0.5</span>),</span><br><span class="line">      createStar(float3(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>), fixed3(<span class="number">1</span>, <span class="number">0.5</span>, <span class="number">0.5</span>), <span class="number">1</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 背景色を定義</span></span><br><span class="line">fixed4 <span class="title function_">drawBackground</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="keyword">return</span> fixed4(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 星を描画</span></span><br><span class="line">fixed4 <span class="title function_">drawStars</span><span class="params">(float3 dir)</span></span><br><span class="line">&#123;</span><br><span class="line">      float3 o = float3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">      &#123;</span><br><span class="line">            float3 direction = normalize(stars[i].direction);</span><br><span class="line">            fixed3 color = normalize(stars[i].color);</span><br><span class="line">            <span class="type">float</span> angle = dot(dir, direction);</span><br><span class="line">            o += color * <span class="built_in">pow</span>(max(<span class="number">0.0</span>, angle), _radiusCoefficient * (stars[i].magnitude + <span class="number">2</span>)) * <span class="built_in">pow</span>(<span class="number">2.5</span>, <span class="number">-1</span> * stars[i].magnitude) * _brightnessCoefficient;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> float4(o, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 各ピクセルごとの色を決定</span></span><br><span class="line">fixed4 <span class="title function_">frag</span><span class="params">(v2f i)</span> : SV_Target</span><br><span class="line">&#123;</span><br><span class="line">      <span class="keyword">return</span> drawBackground() + drawStars(i.texcoord);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>コメントで書いている通りなのですが、<code>frag()</code>という関数の返り値に応じて、画面上の各ピクセルごとの色が決定されます。（<code>#pragma fragment frag</code>という記述で定義しています）</p>
<p>この<code>frag()</code>の引数である<code>i</code>のメンバ変数<code>texcoord</code>には、画面内の各ピクセルにおける視線方向のベクトルが格納されています。この視線方向のベクトルと、別途定義している星の存在する方向を示しているベクトルとの内積を取ることで、どのピクセルに星を描画するべきかを決定しているのが<code>drawStars()</code>です。ざっくり書くと、視線方向と星の存在する方向が同じであれば星を描画し、若干ずれていたとしても、星の明るさに応じてほんの少しは描画する。みたいなことを表現しています。これを星の数だけ繰り返すようループしています。なお、shader では単純なループは適切に最適化され、並列処理が行われます。配列の要素間のやり取りなど、直列実行が不可避なものに関しては並列化されませんが、そもそもそういう処理は GPU で実施することを推奨されません。</p>
<p>さて、この Shader を Skybox に適用するとどのように星が見えるかというと、こんな感じです。</p>
<img src="/images/20230901a/image.png" alt="image.png" width="1200" height="602" loading="lazy">

<p>結構それっぽい気がしますね。</p>
<p>ではここからどんどん星を増やしていきましょう。と思ったのですが、以下のような制約の壁にぶつかり続け、結局は断念しました。</p>
<ul>
<li>Shader では外部ファイルからデータを読み込んで描画することができない。<ul>
<li>そのため、星の情報をすべてハードコーディングすることになりました。</li>
<li>ファイル読み込みを C#で行い、Shader に結果を渡す、みたいなこともできる気がしたのですが、うまく行かず…</li>
</ul>
</li>
<li>Shader で利用できる配列の要素数に上限があった。<ul>
<li>1 配列の要素数、ではなく、全配列の要素数の合計が 4096 以下である必要があるようでした。</li>
<li>そのため、配列ではなく個別に変数を大量に宣言することになりました。</li>
</ul>
</li>
<li>10 万個の星を描こうとしたところ、Shader のコンパイルがタイムアウトした。<ul>
<li>個別変数の数に応じてコンパイル時間が伸びていき、やがてはタイムアウトしてしまいました。</li>
<li>環境変数でタイムアウト時間が設定されているようなので、伸ばすことは可能そうなのですが、とりあえずは星の数を減らして試してみることにしました。</li>
</ul>
</li>
<li>1 万個ぐらいの星を描いたあたりで、PC が唸りを上げ始めた。<ul>
<li>GPU がフル回転を始めました。</li>
<li>あと普通にめちゃくちゃ重たくなっていたため、ここで心が折れました。</li>
</ul>
</li>
</ul>
<p>一応ある程度は描けていたので供養のためキャプチャを掲載しておきます。</p>
<img src="/images/20230901a/image_2.png" alt="" width="1200" height="728" loading="lazy">

<p>なんか、星空って感じではないですね？</p>
<p>もしかしたら色や明るさを計算するロジックにバグがあるのかもしれませんが、心が折れたのでこれ以上は深追いしません。</p>
<h2 id="テクスチャを描いて貼り付ける方針に切り替える"><a href="#テクスチャを描いて貼り付ける方針に切り替える" class="headerlink" title="テクスチャを描いて貼り付ける方針に切り替える"></a>テクスチャを描いて貼り付ける方針に切り替える</h2><p>Skybox に動的に星を描く方針は頓挫したし、とりあえず Shader を書いてみるという目的は達成したため、素直にテクスチャを描いて、それを貼り付ける方針に切り替えます。切り替えは大事。</p>
<h3 id="テクスチャを描く"><a href="#テクスチャを描く" class="headerlink" title="テクスチャを描く"></a>テクスチャを描く</h3><p>まずはテクスチャを作成するための星のデータを用意します。</p>
<p>今回 VR プラネタリウムを作るにあたって、とりあえずは実際の星空を再現したいので、観測データを用いることにします。冒頭で星表というものを紹介しましたが、今回はその中でも、ヒッパルコス星表というものを使っていきます。ヒッパルコス衛星により取得されたデータを編纂したもので、12 万弱の星のデータが記録されています。<a target="_blank" rel="noopener" href="https://heasarc.gsfc.nasa.gov/db-perl/W3Browse/w3table.pl?tablehead=name=hipparcos&Action=More+Options">NASA がデータを公開してくれている</a>ので、こちらから必要なデータを取得していきます。</p>
<p>HIP 番号（name）、赤経（ra）、赤緯（dec）、等級（vmag）、B-V 色指数（bv_color）を選択してダウンロードしました。そのままだと使いづらいので、以下コマンドなどで csv に変換しておきます。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> hip.txt | sed <span class="string">&#x27;1,5d&#x27;</span> | sed <span class="string">&#x27;s/ \+|/|/g&#x27;</span> | sed <span class="string">&#x27;s/| \+/|/g&#x27;</span> | awk -F <span class="string">&#x27;|&#x27;</span> -v <span class="string">&#x27;OFS=,&#x27;</span> <span class="string">&#x27;&#123;print $2,$3,$4,$5,$6&#125;&#x27;</span> &gt; hip.csv</span><br></pre></td></tr></table></figure>

<p>この csv をもとにテクスチャを描画する<a target="_blank" rel="noopener" href="https://github.com/shomuMatch/VRPlanetarium/blob/master/hip/drawTexture.py">python スクリプト</a>を作成しました。</p>
<p>ざっくりこんな感じのことをしています。</p>
<ul>
<li>赤経・赤緯を度（degree）に変換して描画する位置を決定する。</li>
<li>等級と赤緯から画像上での星の大きさを決定する。<ul>
<li>本来星はものすごく遠いため、明るさによらず点として見えるはずですが、人の目の錯覚として明るいものは大きく見えたり、大気による散乱効果が明るいほど強いことなどを踏まえ、明るい星ほど大きく描画しています。</li>
<li>天球を平面のテクスチャで表現するため、赤道部分はそのままに、極地に近づくほど横に引き伸ばした描画とする必要があります。</li>
</ul>
</li>
<li>等級・B-V 色指数から各星の色・明るさを決定する。<ul>
<li>観測値である B-V 色指数から星の表面温度を推定、黒体を仮定して表面温度から RGB 値を算出しています。</li>
<li>等級が 1 変わると、2.5 倍明るさが変わるので、HSV 色空間における V 値が等級に応じて増減するようにしています。<ul>
<li>ただし、人の目が明るさ（暗さ）に慣れたり、カメラの露光時間を長くしたりすることで、絶対的な明るさと見かけの明るさは必ずしも一致しないことを考慮し、可変パラメータとしています。</li>
</ul>
</li>
<li>計算の根拠はスクリプト上に参考 URL を記載しています。</li>
</ul>
</li>
<li>ガンマ補正を行う。<ul>
<li>人間の目やカメラによる補正として、ガンマ補正ができるようにしています。こちらもパラメータは可変です。</li>
</ul>
</li>
</ul>
<p>スクリプトにより描画したテクスチャがこちらです。</p>
<img src="/images/20230901a/texture3.9_2.5.png" alt="" width="1200" height="600" loading="lazy">

<p>高解像度画像に、小さな星の点を表示しているので、あまりきらびやかではないです。</p>
<h3 id="テクスチャを-Skybox-に適用する"><a href="#テクスチャを-Skybox-に適用する" class="headerlink" title="テクスチャを Skybox に適用する"></a>テクスチャを Skybox に適用する</h3><p>テクスチャが生成できればあとは Unity に取り込んで、適切に設定するだけです。</p>
<p>まずは Import して、解像度を高めに設定しておきます。</p>
<img src="/images/20230901a/image_3.png" alt="image.png" width="898" height="790" loading="lazy">

<p>そしたら Skybox 用のマテリアルを作成し、Shader を<code>Skybox/Panoramic</code>に、Mapping を<code>Latitude Longitude Layout</code>に設定し、テクスチャのところにインポートしたテクスチャを適用します。</p>
<img src="/images/20230901a/image_4.png" alt="image.png" width="896" height="666" loading="lazy">

<p>最後にメニューの Window -&gt; Rendering &gt; Lighting から Lighting 設定を開き、Environment タブにある Skybox Material に作成した Material をセットします。</p>
<p>これで準備は完了です。VR 環境で見てみましょう。</p>
<img src="/images/20230901a/output.gif" alt="output.gif" width="1024" height="1024" loading="lazy">

<p>うーん…とりあえず、星空っぽくはある…？（なんか、オリオン座の形おかしい気がする。）</p>
<h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>ここまでやっておいてなんなんですが、思ったより微妙でした。<br>考えられる要因はいくつか有ります。</p>
<ul>
<li>解像度が足りていない。<ul>
<li>テクスチャの解像度・VR ヘッドセットの解像度ともに、現実世界には遠く及びません。そのためどうしても星というよりは、なんか光っている点、みたいに見えてしまいます。</li>
</ul>
</li>
<li>星の数が少ない。<ul>
<li>10 万強の星を再現しているとはいえ、当然宇宙に存在するすべての星を再現できているわけではありません。</li>
<li>特に、天の川銀河の外にある銀河の星や、星雲などのデータはヒッパルコス星表には含まれていないため、どうしても実際の星空とは異なってしまいます。</li>
<li>この問題を解決するには、実際に世界各地で撮った星景写真をつなぎ合わせてテクスチャを作るしかないかなあと思います。</li>
</ul>
</li>
<li>臨場感がない。<ul>
<li>これは現実のプラネタリウムにも言えることですが、やはり現地で自然に囲まれながら見る星空、というものに、言語化できない魅力があります。気温や風、音など、単に視覚情報に限らない様々な情報が多角的に私達を魅了しているのだと実感しました。</li>
<li>現実のプラネタリウムでは、この問題を、魅力的なナレーションや上映内容によって補っているのだと思います。</li>
<li>ゲームの背景など、脇役に据えるのであれば、このぐらいでも良いのかもしれません。</li>
</ul>
</li>
</ul>
<p>頑張った割にはこんなものか、というオチになってしまい悔しいですが、ともあれある程度のプラネタリウムを再現できたので、夏の自由研究としては良しとします。<br>ちなみに、今回はヒッパルコス星表のデータを使用しましたが、同じフォーマットでデータを追加することで、自由に星を追加できます。</p>
<p>・・・・・・・・</p>
<img src="/images/20230901a/image_5.png" alt="image.png" width="1200" height="193" loading="lazy">

<p>せっかくなので-75 等星である、「スーパー明るい藤井星」を追加してみました。見てみましょう。</p>
<img src="/images/20230901a/output2.gif" alt="output2.gif" width="1024" height="1024" loading="lazy">

<p>宇宙は、なんか亀裂入ったし光に包まれて終わりました。</p>

          
        </div>
        <footer>
          <section class="social-area">
          <!-- シェアボタン START -->
  <ul class="social-button">
    
    <!-- Twitter -->
    <li>
      <a class="social-btn twitter-btn" target="_blank" href="https://twitter.com/share?url=https://future-architect.github.io/articles/20230901a/&related=twitterapi%2Ctwitter&text=Unity%E3%81%AEShader%E3%81%A7VR%E3%83%97%E3%83%A9%E3%83%8D%E3%82%BF%E3%83%AA%E3%82%A6%E3%83%A0%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F%E3%81%91%E3%81%A9%E3%81%86%E3%81%BE%E3%81%8F%E3%81%84%E3%81%8B%E3%81%9A%E6%82%94%E3%81%97%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E8%87%AA%E4%BD%9C%E3%81%AE%E6%98%9F%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%89%E5%AE%87%E5%AE%99%E3%81%8C%E7%B5%82%E3%82%8F%E3%81%A3%E3%81%9F%20%7C%20%E3%83%95%E3%83%A5%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E6%8A%80%E8%A1%93%E3%83%96%E3%83%AD%E3%82%B0" rel="nofollow noopener">
        <i></i><span class="social-btn-label">ツイート</span>
      </a>
    </li>
    <!-- Facebook -->
    <li>
      <a class="social-btn fb-btn" target="_blank" href="http://www.facebook.com/share.php?u=https://future-architect.github.io/articles/20230901a/&t=Unity%E3%81%AEShader%E3%81%A7VR%E3%83%97%E3%83%A9%E3%83%8D%E3%82%BF%E3%83%AA%E3%82%A6%E3%83%A0%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F%E3%81%91%E3%81%A9%E3%81%86%E3%81%BE%E3%81%8F%E3%81%84%E3%81%8B%E3%81%9A%E6%82%94%E3%81%97%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E8%87%AA%E4%BD%9C%E3%81%AE%E6%98%9F%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%89%E5%AE%87%E5%AE%99%E3%81%8C%E7%B5%82%E3%82%8F%E3%81%A3%E3%81%9F" rel="nofollow noopener">
        <i></i><span class="social-btn-label">シェア</span>
      </a>
    </li>
    <!-- hatebu -->
    <li>
      <a class="social-btn hatebu-btn" target="_blank" href="https://b.hatena.ne.jp/entry/s/future-architect.github.io/articles/20230901a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">はてな</span>
      </a>
    </li>
    <!-- pocket -->
    <li>
      <a class="social-btn pocket-btn" target="_blank" href="https://getpocket.com/save?url=https://future-architect.github.io/articles/20230901a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">1</span>
      </a>
    </li>
    
  </ul>
<!-- シェアボタン END -->

          </section>
          <aside>
            <section class="related-post margin-bottom-40 nav">
              <h2 id="related"><a href="#related" class="headerlink" title="関連記事"></a>関連記事</h2>
              
  <div class="widget">
    <ul class="nav related-post-link"><li class="related-posts-item"><span>2022.08.23</span><span class="snscount">&#9825;24</span><a href=/articles/20220823a/ title="長らく買おう買おうと思っていたMeta Quest 2をとうとう買いました。Meta Quest 2向けに作ってみた、VRテルミンシミュレータというものを題材に記事を書きます。作ったものはこちらです。">Quest2のハンドトラッキングでVRテルミンシミュレータを作ってみた</a></li><li class="related-posts-item"><span>2023.10.13</span><span class="snscount">&#9825;1</span><a href=/articles/20231013a/ title="2023年10月10日、とうとう発売されましたね。Meta Quest 3（以下 Quest3 と略記）が。しっかり予約して発売日に手に入れようとしたんですが、何故か配達日がズレて 1 日遅れで入手しました。">Meta Quest 3開封の儀＆フルカラーパススルーで家にテルミンを置いた<span class="newitem">NEW</span></a></li><li class="related-posts-item"><span>2021.04.19</span><span class="snscount">&#9825;0</span><a href=/articles/20210419a/ title="こんにちは。ブラサカチームの中井です。Tokyo2020のブラインドサッカーチームでVRを駆使したフィットネスアプリを制作したので、その活動・成果を報告をさせていただきます。">ブラサカ活動報告~ストーンフリープロジェクト編~</a></li><li class="related-posts-item"><span>2021.01.08</span><span class="snscount">&#9825;4</span><a href=/articles/20210108/ title="はじめまして！Unity初心者の阿保です。このご時世でフューチャーも完全リモートワークとなり、便利になったことや不便になったことがあります。">自分の分身(3Dアバター)と自作ワールドを作ってみた</a></li><li class="related-posts-item"><span>2023.08.03</span><span class="snscount">&#9825;63</span><a href=/articles/20230803a/ title="Go 1.21 連載の記事を書きます。">Go 1.21 リリース連載 contextパッケージに追加されるWithoutCancelでクライアントとの切断に備えてみる</a></li><li class="related-posts-item"><span>2023.02.03</span><span class="snscount">&#9825;36</span><a href=/articles/20230203a/ title="Go 1.20 連載 7 記事目にして、最終回の本記事では、`go build`コマンドに新たに追加される`-cover`オプションについてお伝えします。せっかくなので実際に使ってみたレポートもお届けしようと思います。">Go 1.20 リリース連載 go build に追加される cover オプション（利用例付き）</a></li></ul>
  </div>
            </section>
            <section class="reference-post margin-bottom-40 nav">
              
  <div class="card">
    <div id="reference" class="reference-lede"><a href="#reference" class="headerlink" title="参照されている記事"></a>この記事を参照している記事</div>
    <ul class="reference-post-link"><li class="reference-posts-item"><a href=/articles/20230830a/ title="今年も夏の自由研究連載を始めますよ記事です。皆さんも一度は通ったことのある小学生の自由研究">夏の自由研究連載2023 を始めます</a></li></ul>
  </div>
            </section>
          </aside>
        </footer>
      </div>
    </article>
  </main>
  <aside class="col-md-3 blog-sidebar">
    <!-- START SIDEBAR  -->


<section class="toc-section">
  <h2 class="margin-top-30">目次</h2>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><span class="toc-text">はじめに</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E7%AD%89"><span class="toc-text">事前準備等</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E6%96%B9%E9%87%9D"><span class="toc-text">大方針</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shader-%E3%81%A7-Skybox-%E3%81%AB%E5%8B%95%E7%9A%84%E3%81%AB%E6%98%9F%E3%82%92%E6%8F%8F%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B"><span class="toc-text">Shader で Skybox に動的に星を描いてみる</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Shader-%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B"><span class="toc-text">Shader を書いてみる</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%86%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3%E3%82%92%E6%8F%8F%E3%81%84%E3%81%A6%E8%B2%BC%E3%82%8A%E4%BB%98%E3%81%91%E3%82%8B%E6%96%B9%E9%87%9D%E3%81%AB%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%8B"><span class="toc-text">テクスチャを描いて貼り付ける方針に切り替える</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%83%86%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3%E3%82%92%E6%8F%8F%E3%81%8F"><span class="toc-text">テクスチャを描く</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%83%86%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3%E3%82%92-Skybox-%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B"><span class="toc-text">テクスチャを Skybox に適用する</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><span class="toc-text">おわりに</span></a></li></ol>
</section>

<section class="category">
<h2 class="margin-top-30">カテゴリー</h2>
<div class="widget">
  <ul class="nav sidebar-categories margin-bottom-40">
  
  <li class=""><a href="/categories/Programming/">Programming (412)</a></li>
<li class=""><a href="/categories/Infrastructure/">Infrastructure (246)</a></li>
<li class=""><a href="/categories/Culture/">Culture (94)</a></li>
<li class=""><a href="/categories/DataScience/">DataScience (60)</a></li>
<li class=""><a href="/categories/IoT/">IoT (34)</a></li>
<li class=""><a href="/categories/DB/">DB (23)</a></li>
<li class=""><a href="/categories/DevOps/">DevOps (21)</a></li>
<li class=""><a href="/categories/Business/">Business (21)</a></li>
<li class=""><a href="/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/">認証認可 (20)</a></li>
<li class=""><a href="/categories/Security/">Security (15)</a></li>
<li class=""><a href="/categories/Management/">Management (15)</a></li>
<li class=""><a href="/categories/VR/">VR (13)</a></li>
<li class=""><a href="/categories/Design/">Design (11)</a></li>

  </ul>
</div>

</section>
<section class="podcast-link">
<h2 class="margin-top-30">Tech Cast</h2>

  <div class="class="widget-wrap">
  <div class="widget">
    <ul class="nav techcast">
      <li><a href="https://podcasters.spotify.com/pod/show/futuretechcast/episodes/38-AIAI-e22h1v0" title="フューチャーがお届けするポッドキャストです。#38 AIグループリーダー加藤さんに聞く「AIチームのミッションと展望」" target="_blank" rel="noopener"> #38 AIグループリーダー加藤さんに聞く「AIチームのミッションと展望」</a></li>
<li><a href="https://podcasters.spotify.com/pod/show/futuretechcast/episodes/37-e227p84" title="フューチャーがお届けするポッドキャストです。#37 自然言語処理を使った文書検索エンジンシステム開発と新規サービス検討（後編）" target="_blank" rel="noopener"> #37 自然言語処理を使った文書検索エンジンシステム開発と新規サービス検討（後編）</a></li>
<li><a href="https://podcasters.spotify.com/pod/show/futuretechcast/episodes/36-e1rdbcu" title="フューチャーがお届けするポッドキャストです。#36 自然言語処理を使った文書検索エンジンシステム開発と新規サービス検討（前編）" target="_blank" rel="noopener"> #36 自然言語処理を使った文書検索エンジンシステム開発と新規サービス検討（前編）</a></li>
    </ul>
  </div>
  </div>
  
</section>
<section class="advent-calendar">
<h2 class="margin-top-30">アドベントカレンダー</h2>
<div class="widget">
  <ul class="nav-flex">
    <li><a href="http://qiita.com/advent-calendar/2023/future" title="フューチャー Advent Calendar 2023 #Qiita" target="_blank" rel="noopener">2023年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2022/future" title="フューチャー Advent Calendar 2022 #Qiita" target="_blank" rel="noopener">2022年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2021/future" title="フューチャー Advent Calendar 2021 #Qiita" target="_blank" rel="noopener">2021年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2020/future" title="フューチャー Advent Calendar 2020 #Qiita" target="_blank" rel="noopener">2020年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2019/future" title="フューチャー Advent Calendar 2019 #Qiita" target="_blank" rel="noopener">2019年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2018/future" title="フューチャー Advent Calendar 2018 #Qiita" target="_blank" rel="noopener">2018年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2017/future" title="フューチャー Advent Calendar 2017 #Qiita" target="_blank" rel="noopener">2017年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2016/future" title="フューチャー Advent Calendar 2016 #Qiita" target="_blank" rel="noopener">2016年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2015/future" title="フューチャー Advent Calendar 2015 #Qiita" target="_blank" rel="noopener">2015年</a></li>
  </ul>
</div>

</section>
<!-- END SIDEBAR -->

  </aside>
</div>

  </section>
</div>

      <!-- BEGIN PRE-FOOTER -->
    <footer>
      <div class="pre-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>About Us</h2>
              <p>経営とITをデザインする、フューチャーの技術ブログです。業務で利用している幅広い技術について紹介します。<br /><br /><a target="_blank" rel="noopener" href="http://www.future.co.jp/">http://www.future.co.jp/</a></p>
              <div class="social-btn twitter-btn twitter-follow-btn">
                <a href="https://twitter.com/intent/follow?screen_name=future_techblog " target="_blank" rel="nofollow noopener">
                  <i></i><span class="tw-btn-label">フューチャー技術ブログをフォロー</span>
                </a>
              </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 col-4 pre-footer-col">
              <h2>Contact</h2>
              <address class="margin-bottom-40">
                <a href="https://www.future.co.jp/recruit/recruit/rec-fresh/" title="新卒採用" target="_blank" rel="noopener">新卒採用</a><br>
                <a href="https://www.future.co.jp/recruit/recruit/rec-career/" title="キャリア採用" target="_blank" rel="noopener">キャリア採用</a><br>
                <a href="https://www.future.co.jp/contact_us/" title="お問い合わせページ" target="_blank" rel="noopener">お問い合わせ</a><br>
                <a href="https://www.future.co.jp/architect/socialmediapolicy/" title="ソーシャルメディアポリシー" target="_blank" rel="noopener">メディアポリシー</a><br><br>
                <a href="mailto:techblog@future.co.jp">techblog@future.co.jp</a>
              </address>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>Contents</h2>
              <a href="https://future-architect.github.io/coding-standards/" title="Future Enterprise Coding Standards" target="_blank" rel="noopener">コーディング規約</a><br>
              <a href="https://future-architect.github.io/typescript-guide/" title="仕事ですぐに使えるTypeScript" target="_blank" rel="noopener">仕事ですぐに使えるTypeScript</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>Event</h2>
              <a href="https://future.connpass.com/" title="経営とITをデザインするフューチャーの勉強会です" target="_blank" rel="noopener">connpass</a><br>
              <a href="https://www.future.co.jp/futureinsightseminar/" title="フューチャーインサイトセミナー" target="_blank" rel="noopener">Webセミナー</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>SNS</h2>
              <a href="https://github.com/future-architect" title="Future's official open source repositories" target="_blank" rel="noopener">GitHub</a><br>
              <a href="https://qiita.com/organizations/future" title="フューチャーのQiita Organizationです" target="_blank" rel="noopener">Qiita</a><br>
              <a href="https://note.future.co.jp/" title="フューチャーの公式note" target="_blank" rel="noopener">未来報</a><br>
              <a href="https://www.youtube.com/channel/UCJUSwYYd0CkGgmEKAW7QVpw" title="フューチャーYoutubeチャネル" target="_blank" rel="noopener">Youtube</a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="container">
          <div class="row">
            <div class="col-md-6 col-sm-6 padding-top-10">
              &copy; 2023 フューチャー技術ブログ<br>
            </div>
          </div>
        </div>
      </div>
    </footer>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X1C28R8H0M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X1C28R8H0M');
  gtag('config', 'UA-74047147-1'); // 過渡期対応
</script>

  </div>
</body>
</html>
