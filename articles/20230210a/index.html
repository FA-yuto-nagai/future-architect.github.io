<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <!--
    ███████╗██╗░░░██╗████████╗██╗░░░██╗██████╗░███████╗
    ██╔════╝██║░░░██║╚══██╔══╝██║░░░██║██╔══██╗██╔════╝
    █████╗░░██║░░░██║░░░██║░░░██║░░░██║██████╔╝█████╗░░
    ██╔══╝░░██║░░░██║░░░██║░░░██║░░░██║██╔══██╗██╔══╝░░
    ██║░░░░░╚██████╔╝░░░██║░░░╚██████╔╝██║░░██║███████╗
    ╚═╝░░░░░░╚═════╝░░░░╚═╝░░░░╚═════╝░╚═╝░░╚═╝╚══════╝
    ████████╗███████╗░█████╗░██╗░░██╗
    ╚══██╔══╝██╔════╝██╔══██╗██║░░██║
    ░░░██║░░░█████╗░░██║░░╚═╝███████║
    ░░░██║░░░██╔══╝░░██║░░██╗██╔══██║
    ░░░██║░░░███████╗╚█████╔╝██║░░██║
    ░░░╚═╝░░░╚══════╝░╚════╝░╚═╝░░╚═╝
    ██████╗░██╗░░░░░░█████╗░░██████╗░
    ██╔══██╗██║░░░░░██╔══██╗██╔════╝░
    ██████╦╝██║░░░░░██║░░██║██║░░██╗░
    ██╔══██╗██║░░░░░██║░░██║██║░░╚██╗
    ██████╦╝███████╗╚█████╔╝╚██████╔╝
    ╚═════╝░╚══════╝░╚════╝░░╚═════╝░
    Welcome engineer.
    https://www.future.co.jp/recruit/
  -->
  
  <title>CloudBuildを使ってプライベートエンドポイントのみのGKEへデプロイ | フューチャー技術ブログ</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  <meta name="description" content="初めにこんにちは！筋肉エンジニアの渡邉です。最近はGCP&#x2F;GKEについて勉強しています。 今回はGitHubへのPushをトリガーにCloudBuildを起動し、プライベートエンドポイントのみのGKE(Google Kubernetes Engine)へデプロイする基盤を作りましたので、共有したいと思います。 GCPリソースはTerraformで作成しています。CloudBuildとGi">
<meta property="og:type" content="article">
<meta property="og:title" content="CloudBuildを使ってプライベートエンドポイントのみのGKEへデプロイ | フューチャー技術ブログ">
<meta property="og:url" content="https://future-architect.github.io/articles/20230210a/index.html">
<meta property="og:site_name" content="フューチャー技術ブログ">
<meta property="og:description" content="初めにこんにちは！筋肉エンジニアの渡邉です。最近はGCP&#x2F;GKEについて勉強しています。 今回はGitHubへのPushをトリガーにCloudBuildを起動し、プライベートエンドポイントのみのGKE(Google Kubernetes Engine)へデプロイする基盤を作りましたので、共有したいと思います。 GCPリソースはTerraformで作成しています。CloudBuildとGi">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/Deploy_Architecture.drawio.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/architecture.drawio.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/2-Application-Access①.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/1-CloudBuild①.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/1-CloudBuild②.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/1-CloudBuild③.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/1-CloudBuild④.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/1-CloudBuild⑤.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/1-CloudBuild⑥.png">
<meta property="og:image" content="https://future-architect.github.io/images/20230210a/1-CloudBuild⑦.png">
<meta property="article:published_time" content="2023-02-09T15:00:00.000Z">
<meta property="article:modified_time" content="2024-02-20T05:41:28.763Z">
<meta property="article:tag" content="GCP">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="GoogleCloud">
<meta property="article:tag" content="GKE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://future-architect.github.io/images/20230210a/Deploy_Architecture.drawio.png">
  
  <link rel="alternate" href="/atom.xml" title="フューチャー技術ブログ" type="application/atom+xml">
  
  <link rel="icon" href="/logo.svg" sizes="any" type="image/svg+xml">
  <link rel="mask-icon" href="/logo.svg" sizes="any" color="#0bd">
  <link rel="icon alternate" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes='180x180' href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes='57x57' href="/apple-touch-icon-57x57.png">
  <link rel="canonical" href="https://future-architect.github.io/articles/20230210a/">
  <meta content="GCP,Kubernetes,GoogleCloud,GKE" name="keywords">
  <meta content="渡邉光" name="author">
  <link rel="preload" as="image" href="/banner.jpg" />
  <link rel='manifest' href='/manifest.webmanifest'/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <link rel="stylesheet" href="/metronic/assets/style.css">
  <link rel="stylesheet" href="/css/theme-styles.css">
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="corporate">
  <div class="wrap" itemscope itemtype="https://schema.org/TechArticle">
  <!-- BEGIN HEADER -->
<header class="header">
	<div class="header-overlay">
		<div class="header-menu"></div>
		<div class="header-title"><a href="/">Future Tech Blog</a></div>
		<div class="header-title-sub">フューチャー技術ブログ</div>
	</div>
</header>
<!-- Header END -->

  <div class="container">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/articles/">Blog</a></li>
    <li class="active">Post</li>
  </ul>
  <section id="main" class="margin-top-30">
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Infrastructure/">Infrastructureカテゴリ</a>
  </div>


    <h2 itemprop="name" class="article-title">CloudBuildを使ってプライベートエンドポイントのみのGKEへデプロイ
  
  <a target="_blank" rel="noopener" href="https://github.com/future-architect/tech-blog/edit/master/source/_posts/2023/20230210a_CloudBuildを使ってプライベートエンドポイントのみのGKEへデプロイ.md" title="Suggest Edits" class="github-edit"><i class="github-edit-icon"></i></a>
  
</h2>

    <div class="row">
  <main class="col-md-9 blog-posts">
    <article id="post-2023/20230210a_CloudBuildを使ってプライベートエンドポイントのみのGKEへデプロイ" class="article article-type-post blog-item" itemscope itemprop="blogPost">
      <div class="article-inner">
        
        <header class="article-header">
          <ul class="blog-info">
            <li class="blog-info-item"><a href="/articles/2023/" class="publish-date"><time datetime="2023-02-09T15:00:00.000Z" itemprop="datePublished">2023.02.10</time></a>
</li>
            <li class="blog-info-item"><li><a href="/authors/%E6%B8%A1%E9%82%89%E5%85%89" title="渡邉光さんの記事一覧へ" class="post-author">渡邉光</a></li></li>
            <li class="blog-info-item">
  
    
    <a href="/tags/GCP/" title="GCPタグの記事へ" class="tag-list-link">GCP</a>
  
    
    <a href="/tags/Kubernetes/" title="Kubernetesタグの記事へ" class="tag-list-link">Kubernetes</a>
  
    
    <a href="/tags/GoogleCloud/" title="GoogleCloudタグの記事へ" class="tag-list-link">GoogleCloud</a>
  
    
    <a href="/tags/GKE/" title="GKEタグの記事へ" class="tag-list-link">GKE</a>
  

</li>
          </ul>
          </header>
        
        <div class="article-entry" itemprop="articleBody">
          
            <h1 id="初めに"><a href="#初めに" class="headerlink" title="初めに"></a>初めに</h1><p>こんにちは！筋肉エンジニアの渡邉です。最近はGCP&#x2F;GKEについて勉強しています。</p>
<p>今回はGitHubへのPushをトリガーにCloudBuildを起動し、プライベートエンドポイントのみのGKE(Google Kubernetes Engine)へデプロイする基盤を作りましたので、共有したいと思います。</p>
<p>GCPリソースはTerraformで作成しています。CloudBuildとGitHubの連携は一部画面による紐づけが必要になるので、手動でCloudBuildを作成した後、terraform importでコード管理するようにしました。</p>
<h1 id="デプロイフロー"><a href="#デプロイフロー" class="headerlink" title="デプロイフロー"></a>デプロイフロー</h1><img src="/images/20230210a/Deploy_Architecture.drawio.png" alt="Deploy_Architecture.drawio.png" width="901" height="264" loading="lazy">

<p>デプロイフローは以下の流れになります。</p>
<ol>
<li>ローカルでアプリケーションコードの修正</li>
<li>ローカルで修正をCommit、GitHubへPush</li>
<li>GitHubへPushされたことをトリガーにCloudBuildが起動</li>
<li>CloudBuildでコンテナをビルド、Artifact RegistoryにコンテナイメージをPush</li>
<li>CloudBuildからGKEへコンテナイメージをデプロイ</li>
</ol>
<h1 id="アプリケーションコード"><a href="#アプリケーションコード" class="headerlink" title="アプリケーションコード"></a>アプリケーションコード</h1><p>Goで記述されたアプリケーションを書きました。<br>リクエストを投げると、Hello world!とVersionとHostnameをレスポンスします。</p>
<p>こちらはディレクトリ構成です。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">├── src</span><br><span class="line">    ├── Dockerfile</span><br><span class="line">    └── cmd</span><br><span class="line">        └── main.go</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><figcaption><span>main.go</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">        <span class="string">&quot;fmt&quot;</span></span><br><span class="line">        <span class="string">&quot;log&quot;</span></span><br><span class="line">        <span class="string">&quot;net/http&quot;</span></span><br><span class="line">        <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        mux := http.NewServeMux()</span><br><span class="line">        mux.HandleFunc(<span class="string">&quot;/&quot;</span>, hello)</span><br><span class="line"></span><br><span class="line">        port := os.Getenv(<span class="string">&quot;PORT&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> port == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">                port = <span class="string">&quot;8080&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        log.Printf(<span class="string">&quot;Server listening on port %s&quot;</span>, port)</span><br><span class="line">        log.Fatal(http.ListenAndServe(<span class="string">&quot;:&quot;</span>+port, mux))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        log.Printf(<span class="string">&quot;Serving request: %s&quot;</span>, r.URL.Path)</span><br><span class="line">        host, _ := os.Hostname()</span><br><span class="line">        fmt.Fprintf(w, <span class="string">&quot;Hello, world!\n&quot;</span>)</span><br><span class="line">        fmt.Fprintf(w, <span class="string">&quot;Version: 1.0.0\n&quot;</span>)</span><br><span class="line">        fmt.Fprintf(w, <span class="string">&quot;Hostname: %s\n&quot;</span>, host)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GKEにデプロイするアプリケーションはコンテナのため、Dockerfileを作成します。<br>Dockerfileは以下の通りです。</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># goバージョン</span></span><br><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.19</span>.<span class="number">1</span>-alpine</span><br><span class="line"><span class="comment"># アップデートとgitのインストール</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk add --update &amp;&amp;  apk add git</span></span><br><span class="line"><span class="comment"># appディレクトリの作成</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> /go/src/app</span></span><br><span class="line"><span class="comment"># ワーキングディレクトリの設定</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /go/src/app</span></span><br><span class="line"><span class="comment"># ホストのファイルをコンテナの作業ディレクトリに移動</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> ./cmd/main.go /go/src/app/</span></span><br><span class="line"><span class="comment"># コンパイル＋実行</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;go&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;main.go&quot;</span> ]</span></span><br><span class="line"><span class="comment"># 公開ポートを設定する</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h1 id="GKEのアーキテクチャ"><a href="#GKEのアーキテクチャ" class="headerlink" title="GKEのアーキテクチャ"></a>GKEのアーキテクチャ</h1><img src="/images/20230210a/architecture.drawio.png" alt="architecture.drawio.png" width="1151" height="429" loading="lazy">

<h2 id="クラスタ構成"><a href="#クラスタ構成" class="headerlink" title="クラスタ構成"></a>クラスタ構成</h2><ul>
<li><strong>クラスタバージョン</strong>：1.23.13-gke.900（リリースチャンネルをSTABLEで構築した時のデフォルトバージョン）</li>
<li><strong>リージョンクラスタ</strong>：本番環境で利用することを考慮して可用性を高くしたいため</li>
<li><strong>VPCネイティブクラスタ</strong>：GKE バージョン 1.21.0-gke.1500 以降のすべてのクラスタはVPCネイティブクラスタがデフォルトのネットワークモードのため</li>
<li><strong>Standardクラスタ</strong>：インフラチームがGKEクラスタを管理することを想定</li>
<li><strong>限定公開クラスタ</strong>：Control Planeへのアクセスがプライベートエンドポイントのみの「パブリックエンドポイントアクセスが無効」で構成しています。ノードには内部IPアドレスしか付与されず、Control Planeへのアクセスは内部ネットワークからのみしかアクセスできません。<br>※この構成は制限が厳しいのでセキュリティ要件的に問題なければ、「パブリック エンドポイント アクセスが有効、承認済みネットワークが有効」で構築してもよいです。</li>
</ul>
<h2 id="Manifest"><a href="#Manifest" class="headerlink" title="Manifest"></a>Manifest</h2><p>GoのアプリケーションコンテナをGKE上にPodとして建てたいので、deploymentを作成します。containers.imageにはArtifact Registryに保存されているイメージ名を指定します。containerPortにはDockerfileのEXPOSEで指定した8080を指定します。</p>
<figure class="highlight yaml"><figcaption><span>deployment.yaml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hello-go-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">hello-go</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">hello-go</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hello-go</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">asia-northeast1-docker.pkg.dev/xxxxxxxxxx/docker-repository/hello-go:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>deploymentを作成するだけでは、podに対して外部からアクセスすることができないのでServiceとIngressを作成します。<br>Ingressを使用するためには、ServiceのtypeをNodePortにしなければならないのでNodePortで構築します。ports.portに80を指定し、ports.targetPortにdeploymentのports.containerPortで指定した8080を指定します。</p>
<p>80番ポートでServiceにアクセスされ、8080番ポートのdeploymentの各Podにルーティングされる仕組みです。</p>
<figure class="highlight yaml"><figcaption><span>service.yaml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hello-go-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">hello-go</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure>

<p>Ingressのmanifestファイルのannotationsには以下を記します。</p>
<ul>
<li>kubernetes.io&#x2F;ingress.class: “gce”：外部ロードバランサの作成します</li>
<li>kubernetes.io&#x2F;ingress.allow-http: “false”：クライアントとHTTP(S)ロードバランサ間のすべての通信をHTTPSに強制します</li>
<li>kubernetes.io&#x2F;ingress.global-static-ip-name： “loadbalancer-external-ip-address”：事前にterraformで構築していた静的外部IPアドレスを外部ロードバランサに設定します</li>
<li>networking.gke.io&#x2F;managed-certificates: “hello-go”：クライアントとからのHTTPS通信を実現するためGoogleマネージド証明書をIngressに適用します（後述のmanaged-certificate.yamlで作成）</li>
</ul>
<p>Ingressのbackendには、先ほど作成したServiceを指定し、port.numberはserviceのポート80番を指定して紐づけます。</p>
<figure class="highlight yaml"><figcaption><span>ingress.yaml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hello-go-ingress</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="comment"># 外部ロードバランサの作成</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">&quot;gce&quot;</span></span><br><span class="line">    <span class="comment"># クライアントとHTTP(S)ロードバランサ間のすべての通信をHTTPSに強制</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.allow-http:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">    <span class="comment"># 事前に用意していた静的外部IPアドレスを設定する</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.global-static-ip-name:</span> <span class="string">&quot;loadbalancer-external-ip-address&quot;</span></span><br><span class="line">    <span class="comment"># Googleマネージド証明書をIngressに適用する</span></span><br><span class="line">    <span class="attr">networking.gke.io/managed-certificates:</span> <span class="string">&quot;hello-go&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">hello-go-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p>Ingressに適用させるGoogleマネージド証明書を作成します。<br>ドメインはterraformで作成済みの静的外部IPアドレスにフリーなワイルドカードDNSのnip.ioを設定しました。</p>
<figure class="highlight yaml"><figcaption><span>managed-certificate.yaml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.gke.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ManagedCertificate</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hello-go</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">domains:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">34.</span><span class="string">xxx.xxx.xxx.nip.io</span></span><br></pre></td></tr></table></figure>

<p>manifestファイルの適用自体は踏み台サーバから実行しています。</p>
<p>ここまで構築するとドメインに対してアクセスすると以下のキャプチャのように</p>
<ul>
<li>Hello, world!</li>
<li>Version:1.0.0</li>
<li>Hostname: hello-go-deployment-c58cf7b66-fwgbb</li>
</ul>
<p>がブラウザ上に返却されます。</p>
<img src="/images/20230210a/2-Application-Access①.png" alt="2-Application-Access①.png" width="344" height="119" loading="lazy">


<h1 id="CloudBuildの作成"><a href="#CloudBuildの作成" class="headerlink" title="CloudBuildの作成"></a>CloudBuildの作成</h1><p>現状の状態だと</p>
<ol>
<li>アプリケーションコードの変更を行う（ローカル）。</li>
<li>GitHubへ変更をPushする（ローカル）。</li>
<li>docker buildコマンドの実行を行いイメージを作成する（ローカル）</li>
<li>docker pushコマンドを実行し、Artifact RegistoryへイメージをPushする（ローカル）</li>
<li>踏み台サーバにログインして<code>kubectl apply -f deployment.yaml</code> コマンドを実行してデプロイ</li>
</ol>
<p>となるため、デプロイまでに非常に手間がかかります。<br>GitHubへのPushをトリガーに上記の手順の3~5を自動化したいため、CloudBuildを利用します。</p>
<h2 id="CloudBuildトリガーの作成"><a href="#CloudBuildトリガーの作成" class="headerlink" title="CloudBuildトリガーの作成"></a>CloudBuildトリガーの作成</h2><h3 id="GitHubとの連携"><a href="#GitHubとの連携" class="headerlink" title="GitHubとの連携"></a>GitHubとの連携</h3><p>CloudBuildとGitHub（プライベートリポジトリ）を連携するためには画面での認証手続きが生じるため、一旦Terraformでは作成せず手動で設定を行いました。<br>手動で設定が完了した後、terraform importコマンドを利用してコード管理するようにします。</p>
<p>Google Cloudコンソール画面から「Cloud Build」をクリック→「トリガー」をクリック→「トリガーを作成」をクリックします。</p>
<img src="/images/20230210a/1-CloudBuild①.png" alt="1-CloudBuild①.png" width="975" height="882" loading="lazy">
トリガーの作成画面で

<ul>
<li>名前：sample-build</li>
<li>リージョン：asia-northeast1</li>
<li>イベント：ブランチにpushする</li>
</ul>
<p>を入力し、ソース：「新しいリポジトリに接続」をクリックします。</p>
<img src="/images/20230210a/1-CloudBuild②.png" alt="1-CloudBuild②.png" width="979" height="884" loading="lazy">

<p>リポジトリに接続画面で</p>
<ul>
<li>ソースを選択：GitHub (Cloud Build GitHubアプリ)<br>を選択し、「続行」をクリックする。</li>
</ul>
<img src="/images/20230210a/1-CloudBuild③.png" alt="1-CloudBuild③.png" width="579" height="938" loading="lazy">

<p>Sign in to GitHub to continue to Google Cloud Buildの画面で</p>
<ul>
<li>Username or email address：自身のGitHubアカウントのユーザ名</li>
<li>Password：自身のGitHubアカウントのパスワード</li>
</ul>
<p>を入力し、「Sign in」をクリックします。</p>
<img src="/images/20230210a/1-CloudBuild④.png" alt="1-CloudBuild④.png" width="322" height="581" loading="lazy">

<p>Google Cloud Build by Google Cloud Build would like permission toの画面の「Authorize Google Cloud Build」をクリックします。</p>
<img src="/images/20230210a/1-CloudBuild⑤.png" alt="1-CloudBuild⑤.png" width="1000" height="718" loading="lazy">

<p>リポジトリを選択画面の「GOOGLE CLOUD BUILDのインストール」をクリックします。</p>
<img src="/images/20230210a/1-CloudBuild⑥.png" alt="1-CloudBuild⑥.png" width="572" height="903" loading="lazy">

<p>Install Google Cloud Buildの画面から</p>
<ul>
<li>Only Select repositories：Cloud Buildと連携したいリポジトリ<br>を入力し、「Install」をクリックします。</li>
</ul>
<img src="/images/20230210a/1-CloudBuild⑦.png" alt="1-CloudBuild⑦.png" width="569" height="807" loading="lazy">

<ul>
<li>GitHubアカウント：自身のGitHubアカウント</li>
<li>リポジトリ：Cloud Buildと連携したいリポジトリ<br>を入力し、チェックボックスにチェックを入れて「接続」をクリックします。</li>
</ul>
<img src="/images/20230210a/1-CloudBuild⑧.png" alt="1-CloudBuild⑧.png" width="575" height="901" loading="lazy">


<p>ここまでの設定で、Cloud Buildと自身のGitHubリポジトリを連携させることができます。</p>
<img src="/images/20230210a/1-CloudBuild⑨.png" alt="1-CloudBuild⑨.png" width="975" height="882" loading="lazy">

<h3 id="terraform-importの実行"><a href="#terraform-importの実行" class="headerlink" title="terraform importの実行"></a>terraform importの実行</h3><p>作成したトリガーの「実行」の隣をクリックし、リソースパスをコピーをクリックします。（terraform importで利用します。）<br><img src="/images/20230210a/1-CloudBuild⑩.png" alt="1-CloudBuild⑩.png" width="1011" height="883" loading="lazy"></p>
<p>terraform実行環境にて、terraform importを実行し、手動で作成したCloud Buildトリガーをコード管理できるように設定します。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">xxxxxxxx@xxxxxxxx:~/cloud-provider/gcp/gke$ terraform import google_cloudbuild_trigger.trigger projects/xxxxxxxxx/locations/asia-northeast1/triggers/f51e2b94-2be8-4ec6-a983-72ded1f69bb7</span><br><span class="line">google_cloudbuild_trigger.trigger: Importing from ID <span class="string">&quot;projects/xxxxxxxxx/locations/asia-northeast1/triggers/f51e2b94-2be8-4ec6-a983-72ded1f69bb7&quot;</span>...</span><br><span class="line">google_cloudbuild_trigger.trigger: Import prepared!</span><br><span class="line">  Prepared google_cloudbuild_trigger <span class="keyword">for</span> import</span><br><span class="line">google_cloudbuild_trigger.trigger: Refreshing state... [<span class="built_in">id</span>=projects/xxxxxxxxx/locations/asia-northeast1/triggers/f51e2b94-2be8-4ec6-a983-72ded1f69bb7]</span><br><span class="line"></span><br><span class="line">Import successful!</span><br><span class="line"></span><br><span class="line">The resources that were imported are shown above. These resources are now <span class="keyword">in</span></span><br><span class="line">your Terraform state and will henceforth be managed by Terraform.</span><br></pre></td></tr></table></figure>

<p>terraform import後</p>
<ul>
<li>サービスアカウントの設定</li>
<li>ビルド実行時に必要なビルド構成ファイルのパスを設定</li>
<li>ビルド構成ファイルに必要な環境変数</li>
</ul>
<p>を指定してterraform applyをして適用します。</p>
<h1 id="CloudBuildからGKE-Control-Planeへの接続"><a href="#CloudBuildからGKE-Control-Planeへの接続" class="headerlink" title="CloudBuildからGKE Control Planeへの接続"></a>CloudBuildからGKE Control Planeへの接続</h1><p>今回、Control Planeへのアクセスにプライベートエンドポイントのみの「パブリックエンドポイントアクセスが無効」でGKEを構成しているため、CloudBuildからGKE Control Planeへの接続も内部ネットワーク経由でプライベートエンドポイントに対して行わなければいけません。<br>（GKEをパブリック エンドポイント アクセスが有効、承認済みネットワークが有効で構成している場合は、CloudBuildからGKE Control Planeへのアクセスもパブリックエンドポイントに対して行う必要がありますが、CloudBuildの外部IPはユーザで指定できずビルド環境ごとに変わってしまい、承認済みネットワークが定義できないので、少しトリッキーなやり方をしないとアクセスができないです。）<br>CloudBuildからGKE Control Planeのプライベートエンドポイント接続を内部ネットワークを経由するようにしたいので、CloudBuildをPrivate Poolを利用するように作成します。<br>Cloud Build プライベート プールを使用した限定公開 Google Kubernetes Engine クラスタへのアクセスはGoogle Cloudの<a target="_blank" rel="noopener" href="https://cloud.google.com/architecture/accessing-private-gke-clusters-with-cloud-build-private-pools">アーキテクチャセンター</a>にも記載されているので、詳しくはこちらの記事をご覧ください。</p>
<h2 id="ネットワークアーキテクチャ"><a href="#ネットワークアーキテクチャ" class="headerlink" title="ネットワークアーキテクチャ"></a>ネットワークアーキテクチャ</h2><p>CloudBuildからGKEへデプロイするためのネットワークアーキテクチャの完成図になります。<br><img src="/images/20230210a/New_architecture.drawio.png" alt="New_architecture.drawio.png" width="1200" height="355" loading="lazy"></p>
<p>それぞれ詳細を見ていきましょう。</p>
<h3 id="CloudBuild-Private-Poolとsample-build-vpc間"><a href="#CloudBuild-Private-Poolとsample-build-vpc間" class="headerlink" title="CloudBuild Private Poolとsample-build-vpc間"></a>CloudBuild Private Poolとsample-build-vpc間</h3><img src="/images/20230210a/between_sample_vpc_private_pool.drawio.png" alt="between_sample_vpc_private_pool.drawio.png" width="1200" height="355" loading="lazy">

<p>Private Poolは、サービスプロデューサーネットワークと呼ばれる Google 所有の Virtual Private Cloud ネットワークでホストされます。サービスプロデューサーネットワークだけでは、GKE Control Planeへアクセスするルートがないので、Private Poolとプライベート接続する用のVPC(sample-build-vpc)を別途作成します。</p>
<p>Private Poolとプライベート接続する用のVPCには、<strong>名前付きIP範囲</strong>を指定することができるので、<strong>192.168.3.0&#x2F;24</strong>を設定します。private poolが、このIPアドレス範囲からGKEのControl Planeにトラフィックを送信できるので、こちらのIP範囲をGKEの承認済みネットワークに定義します。</p>
<p>名前付きIP範囲には以下のIP範囲は避けるように<a target="_blank" rel="noopener" href="https://cloud.google.com/build/docs/private-pools/set-up-private-pool-to-use-in-vpc-network?hl=ja#understanding_the_network_configuration_options">公式ドキュメント</a>に記載されているので、注意しましょう。</p>
<blockquote>
<p>※<strong>Cloud Build は、Docker ブリッジ ネットワークの IP 範囲 192.168.10.0&#x2F;24 を予約します。プロジェクト内のリソースに IP 範囲を割り当てる際、Cloud Build ビルダーがこれらのリソースにアクセスする場合は、192.168.10.0&#x2F;24 以外の範囲を選択することをおすすめします。</strong></p>
</blockquote>
<img src="/images/20230210a/4-network-architecuture③.png" alt="4-network-architecuture③.png" width="1200" height="844" loading="lazy">

<p>この時サービスのプライベート接続でカスタムルートのエクスポートは「有効」に設定してください。<br>この設定により、のちにPrivate PoolにGKE Control PlaneのCIDR(192.168.64.0&#x2F;28)が広報されます。<br><img src="/images/20230210a/4-network-architecuture④.png" alt="4-network-architecuture④.png" width="1200" height="847" loading="lazy"></p>
<h3 id="GKE-Control-Planeとmy-stg-environment-vpc間"><a href="#GKE-Control-Planeとmy-stg-environment-vpc間" class="headerlink" title="GKE Control Planeとmy-stg-environment-vpc間"></a>GKE Control Planeとmy-stg-environment-vpc間</h3><img src="/images/20230210a/between_gke_control_plane_my_stg_environment.drawio.png" alt="between_gke_control_plane_my_stg_environment.drawio.png" width="1200" height="355" loading="lazy">

<p>GKE Control Planeとmy-stg-environment-vpcを接続しているVPC Peeringのカスタムルートのエクスポートを有効化します。<br>これにより、のちにHA VPN Gatewayを通じて広報されてきたPrivate PoolのCIDR(192.168.3.0&#x2F;24)をGKE Control Plane側に広報することができます。<br><img src="/images/20230210a/4-network-architecuture①.png" alt="4-network-architecuture①.png" width="1200" height="849" loading="lazy"></p>
<h3 id="HA-VPNの作成"><a href="#HA-VPNの作成" class="headerlink" title="HA VPNの作成"></a>HA VPNの作成</h3><img src="/images/20230210a/between_sample_build_vpc_my_stg_environment.drawio.png" alt="between_sample_build_vpc_my_stg_environment.drawio.png" width="1200" height="355" loading="lazy">

<p>CloudBuildのprivate poolのCIDR(192.168.3.0&#x2F;24)をmy-stg-environment-vpcに、GKE Control PlaneのCIDR(192.168.64.0&#x2F;28)をsample-build-vpcにそれぞれ広報したいので、my-stg-environment-vpcとsample-build-vpcをHA VPNで接続します。</p>
<p>VPC PeeringでそれぞれのVPCを接続することもできますが、VPC Peeringは推移的ピアリングをサポートしていないため、CloudBuildのprivate poolのCIDR(192.168.3.0&#x2F;24)とGKE Control PlaneのCIDR(192.168.64.0&#x2F;28)をそれぞれのVPCへ広報することができません。</p>
<p>まず、HA VPN Gatewayを作成します。<br>my-stg-environment-vpcに「ha-vpn-my-stg-environment-tky-gw」、sample-build-vpcに「ha-vpn-sample-build-vpc-tky-gw」を作成します。</p>
<img src="/images/20230210a/4-network-architecuture⑦.png" alt="4-network-architecuture⑦.png" width="1200" height="504" loading="lazy">

<p>次に、それぞれのHA VPN Gatewayに対応するVPN Tunnelを作成します。</p>
<p>ha-vpn-my-stg-environment-tky-gwに</p>
<ul>
<li>「ha-vpn-my-stg-environment-tky-tunnel-0」</li>
<li>「ha-vpn-my-stg-environment-tky-tunnel-1」</li>
</ul>
<p>を</p>
<p>ha-vpn-sample-build-vpc-tky-gwに</p>
<ul>
<li>「ha-vpn-sample-build-vpc-tky-tunnel-0」</li>
<li>「ha-vpn-sample-build-vpc-tky-tunnel-1」<br>を作成します。</li>
</ul>
<img src="/images/20230210a/4-network-architecuture⑧.png" alt="4-network-architecuture⑧.png" width="1200" height="511" loading="lazy">

<p>次に、それぞれのHA VPN Tunnelに対応するCloud Routerを作成します。</p>
<ul>
<li>ha-vpn-my-stg-environment-tky-rt</li>
</ul>
<p>sample-build-vpcにGKE Control PlaneのCIDR(192.168.64.0&#x2F;28)を広報したいので、アドバタイズされたIP範囲に192.168.64.0&#x2F;28を設定します。</p>
<ul>
<li>ha-vpn-sample-build-vpc-tky-rt</li>
</ul>
<p>my-stg-environmentにCloudBuild Private PoolのCIDR(192.168.3.0&#x2F;24)を広報したいので、アドバタイズされたIP範囲に192.168.3.0&#x2F;24を設定します。</p>
<img src="/images/20230210a/4-network-architecuture⑨.png" alt="4-network-architecuture⑨.png" width="1200" height="840" loading="lazy">

<img src="/images/20230210a/4-network-architecuture⑩.png" alt="4-network-architecuture⑩.png" width="1200" height="847" loading="lazy">



<p>ここまでの設定で、CloudBuildからGKEへデプロイするためのネットワークアーキテクチャの完成になります。</p>
<h1 id="デプロイの実施"><a href="#デプロイの実施" class="headerlink" title="デプロイの実施"></a>デプロイの実施</h1><p>上記でCloudBuildから内部ネットワークを経由してGKE Contorl Planeへ通信できるルートができたので、実際にデプロイを実施してみましょう。</p>
<h2 id="CloudBuild-yaml"><a href="#CloudBuild-yaml" class="headerlink" title="CloudBuild.yaml"></a>CloudBuild.yaml</h2><p>CloudBuildでビルドを実行するためには、ビルド構成ファイルを作成する必要があります。<br>ビルド構成ファイルには、各ビルドSTEPごとに実行したい処理を記述します。<br>ビルド構成ファイルに記載しているプロパティの内容は以下の通りです。</p>
<div class="scroll"><table>
<thead>
<tr>
<th align="center">キー</th>
<th align="center">内容</th>
</tr>
</thead>
<tbody><tr>
<td align="center">name</td>
<td align="center">タスクを実行するコンテナイメージを指すように指定します</td>
</tr>
<tr>
<td align="center">id</td>
<td align="center">ビルドステップの識別子を指定します</td>
</tr>
<tr>
<td align="center">args</td>
<td align="center">nameに指定したイメージ実行時に渡す引数を記述します</td>
</tr>
<tr>
<td align="center">dir</td>
<td align="center">ビルド実行時の作業ディレクトリを指定します。</td>
</tr>
<tr>
<td align="center">env</td>
<td align="center">ビルド実行時に使用される環境変数を指定します。</td>
</tr>
</tbody></table></div>
<p>以下のビルド構成ファイルの内容に従ってビルドが実行されていきます。</p>
<figure class="highlight yaml"><figcaption><span>CloudBuild.yaml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="attr">steps:</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment"># イメージをビルド</span></span><br><span class="line"><span class="comment"># （$SHORT_SHAはGitコミットのタグの値、ビルドしたDockerイメージに同じタグ付け）</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;gcr.io/cloud-builders/docker&#x27;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">&#x27;Build Image&#x27;</span></span><br><span class="line">    <span class="attr">args:</span> [<span class="string">&#x27;build&#x27;</span>, <span class="string">&#x27;-t&#x27;</span>, <span class="string">&#x27;asia-northeast1-docker.pkg.dev/$PROJECT_ID/docker-repository/hello-go:$SHORT_SHA&#x27;</span>, <span class="string">&quot;.&quot;</span>]</span><br><span class="line">    <span class="attr">dir:</span> <span class="string">&#x27;gcp/gke/src&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment"># ビルドイメージをArtifact Registry にPush</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;gcr.io/cloud-builders/docker&#x27;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">&#x27;Push to GCR&#x27;</span></span><br><span class="line">    <span class="attr">args:</span> [<span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;asia-northeast1-docker.pkg.dev/$PROJECT_ID/docker-repository/hello-go:$SHORT_SHA&#x27;</span>]</span><br><span class="line">    <span class="attr">dir:</span> <span class="string">&#x27;gcp/gke/src&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment"># ビルドしたイメージタグを利用するように、manifestを書き換える</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;ubuntu&#x27;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">&#x27;Tag Override&#x27;</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bash</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;sed -i.bk s/latest/$SHORT_SHA/g deployment.yaml&#x27;</span></span><br><span class="line">    <span class="attr">dir:</span> <span class="string">&#x27;gcp/gke/manifest&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment"># デプロイ</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;gcr.io/cloud-builders/kubectl&quot;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">&#x27;kubectl apply&#x27;</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">apply</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--filename=deployment.yaml</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;CLOUDSDK_COMPUTE_REGION=$&#123;_REGION&#125;&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;CLOUDSDK_CONTAINER_CLUSTER=$&#123;_CLUSTER_NAME&#125;&#x27;</span></span><br><span class="line">    <span class="attr">dir:</span> <span class="string">&#x27;gcp/gke/manifest&#x27;</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment"># オプション</span></span><br><span class="line"><span class="comment"># ビルド実行ログはCloud Loggingへ</span></span><br><span class="line"><span class="comment"># ビルド実行環境はprivate poolを指定</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="attr">options:</span></span><br><span class="line">  <span class="attr">logging:</span> <span class="string">CLOUD_LOGGING_ONLY</span></span><br><span class="line">  <span class="attr">workerPool:</span></span><br><span class="line">    <span class="string">&#x27;projects/$PROJECT_ID/locations/$&#123;_REGION&#125;/workerPools/private-build-pool&#x27;</span></span><br></pre></td></tr></table></figure>
<p>こちらのcloudbuild.yamlをGitHub上のルートディレクトリ内に保存します。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">├── api_service.tf</span><br><span class="line">├── artifact_registry.tf</span><br><span class="line">├── cloudbuild.tf</span><br><span class="line">├── cloudbuild.yaml <span class="comment"># ★追加</span></span><br><span class="line">├── compute_address.tf</span><br><span class="line">├── compute_container.tf</span><br><span class="line">├── compute_engine.tf</span><br><span class="line">├── compute_firewall.tf</span><br><span class="line">├── compute_global_address.tf</span><br><span class="line">├── compute_network.tf</span><br><span class="line">├── compute_router_nat.tf</span><br><span class="line">├── ha_vpn.tf</span><br><span class="line">├── locals.tf</span><br><span class="line">├── project.tf</span><br><span class="line">├── project_iam_member.tf</span><br><span class="line">├── provider.tf</span><br><span class="line">├── service_account.tf</span><br><span class="line">├── versions.tf</span><br><span class="line">├── manifest</span><br><span class="line">│   ├── deployment.yaml</span><br><span class="line">│   ├── ingress.yaml</span><br><span class="line">│   ├── managed-certificate.yaml</span><br><span class="line">│   └── service.yaml</span><br><span class="line">├── src</span><br><span class="line">    ├── Dockerfile</span><br><span class="line">    └── cmd</span><br><span class="line">        └── main.go</span><br></pre></td></tr></table></figure>

<h2 id="アプリケーションコードの修正"><a href="#アプリケーションコードの修正" class="headerlink" title="アプリケーションコードの修正"></a>アプリケーションコードの修正</h2><p>Version: 1.0.0　→　Version: 2.0.0へ修正してmainブランチにPushします。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">xxxxxx@xxxxxx:~/cloud-provider/gcp/gke$ git diff src/cmd/main.go</span><br><span class="line">diff --git a/gcp/gke/src/cmd/main.go b/gcp/gke/src/cmd/main.go</span><br><span class="line">index db8369b..8d603f5 100644</span><br><span class="line">--- a/gcp/gke/src/cmd/main.go</span><br><span class="line">+++ b/gcp/gke/src/cmd/main.go</span><br><span class="line">@@ -25,6 +25,6 @@ func hello(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">         log.Printf(<span class="string">&quot;Serving request: %s&quot;</span>, r.URL.Path)</span><br><span class="line">         host, _ := os.Hostname()</span><br><span class="line">         fmt.Fprintf(w, <span class="string">&quot;Hello, world!\n&quot;</span>)</span><br><span class="line">-        fmt.Fprintf(w, <span class="string">&quot;Version: 1.0.0\n&quot;</span>)</span><br><span class="line">+        fmt.Fprintf(w, <span class="string">&quot;Version: 2.0.0\n&quot;</span>)</span><br><span class="line">         fmt.Fprintf(w, <span class="string">&quot;Hostname: %s\n&quot;</span>, host)</span><br><span class="line"> &#125;</span><br><span class="line">\ No newline at end of file</span><br><span class="line">xxxxxx@xxxxxx:~/cloud-provider/gcp/gke$ git add src/cmd/main.go</span><br><span class="line">xxxxxx@xxxxxx:~/cloud-provider/gcp/gke$ git diff src/cmd/main.go</span><br><span class="line">xxxxxx@xxxxxx:~/cloud-provider/gcp/gke$ git commit -m <span class="string">&quot;modify Version&quot;</span></span><br><span class="line">[main 0f0a907] modify Version</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">xxxxxx@xxxxxx:~/cloud-provider/gcp/gke$ git push origin main</span><br><span class="line">Enumerating objects: 20, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (20/20), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 20 threads</span><br><span class="line">Compressing objects: 100% (10/10), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (14/14), 1.05 KiB | 1.05 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 14 (delta 4), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (4/4), completed with 2 <span class="built_in">local</span> objects.</span><br><span class="line">To https://GitHub.com/xxxxxxxx/xxxxxxxx.git</span><br><span class="line">   cef9c7d..0f0a907  main -&gt; main</span><br></pre></td></tr></table></figure>

<h2 id="CloudBuildのビルド画面"><a href="#CloudBuildのビルド画面" class="headerlink" title="CloudBuildのビルド画面"></a>CloudBuildのビルド画面</h2><p>GitHubにPushされたことをトリガーにCloudBuildのビルドが実行されます。（過去にビルドに苦戦したビルド履歴が残っていますね。。。（笑））</p>
<img src="/images/20230210a/3-Deploy①.png" alt="3-Deploy①.png" width="1200" height="847" loading="lazy">

<p>最新のビルド履歴（9ee5d0a6）をクリックすると、詳細が確認できます。cloudbuild.yamlに記述したビルドステップごとにビルドが進行していきます。各ビルドステップごとのログも「ビルドログ」から確認することができます。</p>
<p>正常終了するとすべてのステップでグリーンになります。</p>
<img src="/images/20230210a/3-Deploy②.png" alt="3-Deploy②.png" width="1200" height="854" loading="lazy">

<p>CloudBuildのビルドが正常終了したので、再度ドメインに対してアクセスをします。</p>
<p>すると、変更を加えたVersion：2.0.0の状態でレスポンスが返却され、デプロイが正常に完了したことを確認できました。</p>
<img src="/images/20230210a/3-Deploy③.png" alt="3-Deploy③.png" width="352" height="93" loading="lazy">

<h2 id="Podのライフサイクル"><a href="#Podのライフサイクル" class="headerlink" title="Podのライフサイクル"></a>Podのライフサイクル</h2><p>最後のビルドステップでGKEへのデプロイが行われます。</p>
<p>踏み台サーバから<code>kubectl get pods -w</code>を実行することでGKE上のPodの状態を確認することができます。</p>
<p>ビルドしたイメージをPullしてデプロイされることで、もともと存在していたPodが次々と終了し、新しいPodが作成されていることがわかります。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">xxxxxx@xxxxxx@tky-bastion:~$ kubectl get pod -w</span><br><span class="line">NAME                                   READY   STATUS    RESTARTS   AGE</span><br><span class="line">hello-go-deployment-78b555bdf6-rv8sh   1/1     Running   0          2m40s</span><br><span class="line">hello-go-deployment-78b555bdf6-z5rk8   1/1     Running   0          2m22s</span><br><span class="line">hello-go-deployment-78b555bdf6-zpczj   1/1     Running   0          2m58s</span><br><span class="line">hello-go-deployment-b788f4444-vcq82    0/1     Pending   0          0s</span><br><span class="line">hello-go-deployment-b788f4444-vcq82    0/1     Pending   0          0s</span><br><span class="line">hello-go-deployment-b788f4444-vcq82    0/1     Pending   0          0s</span><br><span class="line">hello-go-deployment-b788f4444-vcq82    0/1     ContainerCreating   0          0s</span><br><span class="line">hello-go-deployment-b788f4444-vcq82    1/1     Running             0          3s</span><br><span class="line">hello-go-deployment-b788f4444-vcq82    1/1     Running             0          10s</span><br><span class="line">hello-go-deployment-b788f4444-vcq82    1/1     Running             0          10s</span><br><span class="line">hello-go-deployment-78b555bdf6-rv8sh   1/1     Terminating         0          7m11s</span><br><span class="line">hello-go-deployment-b788f4444-cz7ng    0/1     Pending             0          0s</span><br><span class="line">hello-go-deployment-b788f4444-cz7ng    0/1     Pending             0          0s</span><br><span class="line">hello-go-deployment-b788f4444-cz7ng    0/1     Pending             0          0s</span><br><span class="line">hello-go-deployment-b788f4444-cz7ng    0/1     ContainerCreating   0          0s</span><br><span class="line">hello-go-deployment-b788f4444-cz7ng    0/1     ContainerCreating   0          0s</span><br><span class="line">hello-go-deployment-78b555bdf6-rv8sh   0/1     Terminating         0          7m11s</span><br><span class="line">hello-go-deployment-78b555bdf6-rv8sh   0/1     Terminating         0          7m11s</span><br><span class="line">hello-go-deployment-78b555bdf6-rv8sh   0/1     Terminating         0          7m11s</span><br><span class="line">hello-go-deployment-b788f4444-cz7ng    1/1     Running             0          3s</span><br><span class="line">hello-go-deployment-b788f4444-cz7ng    1/1     Running             0          10s</span><br><span class="line">hello-go-deployment-b788f4444-cz7ng    1/1     Running             0          10s</span><br><span class="line">hello-go-deployment-78b555bdf6-zpczj   1/1     Terminating         0          7m39s</span><br><span class="line">hello-go-deployment-b788f4444-hw5cw    0/1     Pending             0          0s</span><br><span class="line">hello-go-deployment-b788f4444-hw5cw    0/1     Pending             0          0s</span><br><span class="line">hello-go-deployment-b788f4444-hw5cw    0/1     Pending             0          0s</span><br><span class="line">hello-go-deployment-b788f4444-hw5cw    0/1     ContainerCreating   0          0s</span><br><span class="line">hello-go-deployment-78b555bdf6-zpczj   0/1     Terminating         0          7m39s</span><br><span class="line">hello-go-deployment-78b555bdf6-zpczj   0/1     Terminating         0          7m39s</span><br><span class="line">hello-go-deployment-78b555bdf6-zpczj   0/1     Terminating         0          7m39s</span><br><span class="line">hello-go-deployment-b788f4444-hw5cw    1/1     Running             0          3s</span><br><span class="line">hello-go-deployment-b788f4444-hw5cw    1/1     Running             0          9s</span><br><span class="line">hello-go-deployment-b788f4444-hw5cw    1/1     Running             0          9s</span><br><span class="line">hello-go-deployment-78b555bdf6-z5rk8   1/1     Terminating         0          7m12s</span><br><span class="line">hello-go-deployment-78b555bdf6-z5rk8   0/1     Terminating         0          7m13s</span><br><span class="line">hello-go-deployment-78b555bdf6-z5rk8   0/1     Terminating         0          7m13s</span><br><span class="line">hello-go-deployment-78b555bdf6-z5rk8   0/1     Terminating         0          7m13s</span><br></pre></td></tr></table></figure>


<h1 id="最後に"><a href="#最後に" class="headerlink" title="最後に"></a>最後に</h1><p>今回はCloudBuildを利用したGKEへの継続デプロイ基盤について記載しました。GKEは限定公開クラスタでControl Planeへのアクセスがプライベートエンドポイントのみの「パブリックエンドポイントアクセスが無効」構築しているため、Cloud BuildからGKEのControl Planeへのアクセスを成功させるためのネットワーク構成が複雑になってしまいましたが、限定公開クラスタで「パブリック エンドポイント アクセスが有効、承認済みネットワークが無効」で構築すればCloudBuildでPrivate PoolやHA VPNで作成することもなくパブリックエンドポイント経由でControl Planeへアクセスができます。セキュリティ要件次第でデプロイフローやアーキテクチャなどは変更してください。</p>
<p>まだまだGKEの知らない機能がたくさんあるので、引き続きインプットとアウトプットをしていきたいと思います。</p>

          
        </div>
        <footer>
          <section class="social-area">
          <!-- シェアボタン START -->
  <ul class="social-button">
    
    <!-- Twitter -->
    <li>
      <a class="social-btn twitter-btn" target="_blank" href="https://twitter.com/share?url=https://future-architect.github.io/articles/20230210a/&related=twitterapi%2Ctwitter&text=CloudBuild%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%97%E3%83%A9%E3%82%A4%E3%83%99%E3%83%BC%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%AE%E3%81%BF%E3%81%AEGKE%E3%81%B8%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%20%7C%20%E3%83%95%E3%83%A5%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E6%8A%80%E8%A1%93%E3%83%96%E3%83%AD%E3%82%B0" rel="nofollow noopener">
        <i></i><span class="social-btn-label">7</span>
      </a>
    </li>
    <!-- Facebook -->
    <li>
      <a class="social-btn fb-btn" target="_blank" href="http://www.facebook.com/share.php?u=https://future-architect.github.io/articles/20230210a/&t=CloudBuild%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%97%E3%83%A9%E3%82%A4%E3%83%99%E3%83%BC%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%AE%E3%81%BF%E3%81%AEGKE%E3%81%B8%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4" rel="nofollow noopener">
        <i></i><span class="social-btn-label">シェア</span>
      </a>
    </li>
    <!-- hatebu -->
    <li>
      <a class="social-btn hatebu-btn" target="_blank" href="https://b.hatena.ne.jp/entry/s/future-architect.github.io/articles/20230210a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">1</span>
      </a>
    </li>
    <!-- pocket -->
    <li>
      <a class="social-btn pocket-btn" target="_blank" href="https://getpocket.com/save?url=https://future-architect.github.io/articles/20230210a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">2</span>
      </a>
    </li>
    
  </ul>
<!-- シェアボタン END -->

          </section>
          <aside>
            <section class="related-post margin-bottom-40 nav">
              <h2 id="related"><a href="#related" class="headerlink" title="関連記事"></a>関連記事</h2>
              
  <div class="widget">
    <ul class="nav related-post-link"><li class="related-posts-item"><span>2023.01.13</span><span class="snscount">&#9825;18</span><a href=/articles/20230113a/ title="GKE を利用したWebアプリケーションのGoogleアカウント認証について記事を書きます。公式ドキュメントを引用します。IAP を使用すると、HTTPS によってアクセスされるアプリケーションの一元的な承認レイヤを確立できるため、ネットワーク レベルのファイアウォールに頼らずに、アプリケーション レベルのアクセス制御モデルを使用できます。">GKEでIdentity-Aware Proxyを利用したWebアプリケーション認証</a></li><li class="related-posts-item"><span>2023.03.30</span><span class="snscount">&#9825;13</span><a href=/articles/20230330a/ title="プロジェクトでJenikisを利用する機会があり、初めてJenkinsfileでTerraformのCI/CD環境を構築する機会があったので記事に残そうと思います。クラウドを使っているとAWSではCodeBuild、Google CloudではCloudBuildのサービスをCI/CD環境として利用するのでyamlでのCI/CDスクリプトには慣れていましたが...">JenkinsでのTerraform CI/CD</a></li><li class="related-posts-item"><span>2023.03.27</span><span class="snscount">&#9825;6</span><a href=/articles/20230327b/ title="Terraform 1.4.0のENHANCEMENTSで以下の機能が追加されました。backend/gcs: Add storage_custom_endpoint argument, to allow communication with the backend via a Private Service Connect endpoint. 内容はtfstateが保存されているGCSへのアクセスがインターネット経由ではなく..">Terraform 1.4 Update:Private Service Connectを利用したbackend/gcsへのアクセス</a></li><li class="related-posts-item"><span>2021.03.19</span><span class="snscount">&#9825;37</span><a href=/articles/20210319/ title="Anthosは2019年にGoogleが発表した、「ハイブリッドクラウド・マルチクラウド環境に対応したアプリケーション管理プラットフォーム」です。発表から2年ほど経って、エンタープライズ向けのシステム構成を検討する際に名前が挙がることも増えてきている実感があります。そんなAnthosですが、構成要素が多くて中々全体像が掴みきれない人も多いのではないかと思います。">Anthosの話についていくための最低限の知識をまとめてみた</a></li><li class="related-posts-item"><span>2021.03.18</span><span class="snscount">&#9825;11</span><a href=/articles/20210318/ title="テーマは、2021年2月24日に公開されたGKE Autopilotです。この記事は、Kubernetesに触ったことがない方でもわかるように、最も簡単な構成で試してみました。Kubernetesを触ったことがない方にもみていただけるとありがたく思います。">GKE Autopilotを触ってみた</a></li><li class="related-posts-item"><span>2020.08.14</span><span class="snscount">&#9825;9</span><a href=/articles/20200814/ title="こんにちは、TIG所属の[村田]です。夏休みの自由研究連載10本目の記事です。今回は夏休みの自由研究企画ということで、Cloud RunのベースであるKnativeを触ってみたいと思います！利用したコンポーネントとバージョンは以下です。記事投稿時点（2020.08.14）での最新バージョンを利用しています。">ぼくのなつやすみ5 -Knativeを知ろう-</a></li></ul>
  </div>
            </section>
            <section class="reference-post margin-bottom-40 nav">
              
            </section>
          </aside>
        </footer>
      </div>
    </article>
  </main>
  <aside class="col-md-3 blog-sidebar">
    <!-- START SIDEBAR  -->


<section class="toc-section">
  <h2 class="margin-top-30">目次</h2>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E3%82%81%E3%81%AB"><span class="toc-text">初めに</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%83%95%E3%83%AD%E3%83%BC"><span class="toc-text">デプロイフロー</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89"><span class="toc-text">アプリケーションコード</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GKE%E3%81%AE%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3"><span class="toc-text">GKEのアーキテクチャ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%BF%E6%A7%8B%E6%88%90"><span class="toc-text">クラスタ構成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Manifest"><span class="toc-text">Manifest</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CloudBuild%E3%81%AE%E4%BD%9C%E6%88%90"><span class="toc-text">CloudBuildの作成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CloudBuild%E3%83%88%E3%83%AA%E3%82%AC%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90"><span class="toc-text">CloudBuildトリガーの作成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GitHub%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA"><span class="toc-text">GitHubとの連携</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#terraform-import%E3%81%AE%E5%AE%9F%E8%A1%8C"><span class="toc-text">terraform importの実行</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CloudBuild%E3%81%8B%E3%82%89GKE-Control-Plane%E3%81%B8%E3%81%AE%E6%8E%A5%E7%B6%9A"><span class="toc-text">CloudBuildからGKE Control Planeへの接続</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3"><span class="toc-text">ネットワークアーキテクチャ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CloudBuild-Private-Pool%E3%81%A8sample-build-vpc%E9%96%93"><span class="toc-text">CloudBuild Private Poolとsample-build-vpc間</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GKE-Control-Plane%E3%81%A8my-stg-environment-vpc%E9%96%93"><span class="toc-text">GKE Control Planeとmy-stg-environment-vpc間</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HA-VPN%E3%81%AE%E4%BD%9C%E6%88%90"><span class="toc-text">HA VPNの作成</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%AE%E5%AE%9F%E6%96%BD"><span class="toc-text">デプロイの実施</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CloudBuild-yaml"><span class="toc-text">CloudBuild.yaml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E4%BF%AE%E6%AD%A3"><span class="toc-text">アプリケーションコードの修正</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CloudBuild%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89%E7%94%BB%E9%9D%A2"><span class="toc-text">CloudBuildのビルド画面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB"><span class="toc-text">Podのライフサイクル</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><span class="toc-text">最後に</span></a></li></ol>
</section>

<section class="category">
<h2 class="margin-top-30">カテゴリー</h2>
<div class="widget">
  <ul class="nav sidebar-categories margin-bottom-40">
  
  <li class=""><a href="/categories/Programming/">Programming (444)</a></li>
<li class=""><a href="/categories/Infrastructure/">Infrastructure (267)</a></li>
<li class=""><a href="/categories/Culture/">Culture (100)</a></li>
<li class=""><a href="/categories/DataScience/">DataScience (62)</a></li>
<li class=""><a href="/categories/IoT/">IoT (35)</a></li>
<li class=""><a href="/categories/DB/">DB (25)</a></li>
<li class=""><a href="/categories/DevOps/">DevOps (23)</a></li>
<li class=""><a href="/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/">認証認可 (21)</a></li>
<li class=""><a href="/categories/Business/">Business (21)</a></li>
<li class=""><a href="/categories/Management/">Management (17)</a></li>
<li class=""><a href="/categories/Security/">Security (15)</a></li>
<li class=""><a href="/categories/VR/">VR (13)</a></li>
<li class=""><a href="/categories/Design/">Design (11)</a></li>

  </ul>
</div>

</section>
<section class="podcast-link">
<h2 class="margin-top-30">Tech Cast</h2>

  <div class="class="widget-wrap">
  <div class="widget">
    <ul class="nav techcast">
      
    </ul>
  </div>
  </div>
  
</section>
<section class="advent-calendar">
<h2 class="margin-top-30">アドベントカレンダー</h2>
<div class="widget">
  <ul class="nav-flex">
    <li><a href="http://qiita.com/advent-calendar/2023/future" title="フューチャー Advent Calendar 2023 #Qiita" target="_blank" rel="noopener">2023年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2022/future" title="フューチャー Advent Calendar 2022 #Qiita" target="_blank" rel="noopener">2022年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2021/future" title="フューチャー Advent Calendar 2021 #Qiita" target="_blank" rel="noopener">2021年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2020/future" title="フューチャー Advent Calendar 2020 #Qiita" target="_blank" rel="noopener">2020年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2019/future" title="フューチャー Advent Calendar 2019 #Qiita" target="_blank" rel="noopener">2019年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2018/future" title="フューチャー Advent Calendar 2018 #Qiita" target="_blank" rel="noopener">2018年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2017/future" title="フューチャー Advent Calendar 2017 #Qiita" target="_blank" rel="noopener">2017年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2016/future" title="フューチャー Advent Calendar 2016 #Qiita" target="_blank" rel="noopener">2016年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2015/future" title="フューチャー Advent Calendar 2015 #Qiita" target="_blank" rel="noopener">2015年</a></li>
  </ul>
</div>

</section>
<!-- END SIDEBAR -->

  </aside>
</div>

  </section>
</div>

      <!-- BEGIN PRE-FOOTER -->
    <footer>
      <div class="pre-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>About Us</h2>
              <p>経営とITをデザインする、フューチャーの技術ブログです。業務で利用している幅広い技術について紹介します。<br /><br /><a target="_blank" rel="noopener" href="http://www.future.co.jp/">http://www.future.co.jp/</a></p>
              <div class="social-btn twitter-btn twitter-follow-btn">
                <a href="https://twitter.com/intent/follow?screen_name=future_techblog " target="_blank" rel="nofollow noopener">
                  <i></i><span class="tw-btn-label">フューチャー技術ブログをフォロー</span>
                </a>
              </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 col-4 pre-footer-col">
              <h2>Contact</h2>
              <address class="margin-bottom-40">
                <a href="https://www.future.co.jp/recruit/recruit/rec-fresh/" title="新卒採用" target="_blank" rel="noopener">新卒採用</a><br>
                <a href="https://www.future.co.jp/recruit/recruit/rec-career/" title="キャリア採用" target="_blank" rel="noopener">キャリア採用</a><br>
                <a href="https://www.future.co.jp/contact_us/" title="お問い合わせページ" target="_blank" rel="noopener">お問い合わせ</a><br>
                <a href="https://www.future.co.jp/architect/socialmediapolicy/" title="ソーシャルメディアポリシー" target="_blank" rel="noopener">メディアポリシー</a><br><br>
                <a href="mailto:techblog@future.co.jp">techblog@future.co.jp</a>
              </address>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>Contents</h2>
              <a href="https://future-architect.github.io/coding-standards/" title="Future Enterprise Coding Standards" target="_blank" rel="noopener">コーディング規約</a><br>
              <a href="https://future-architect.github.io/typescript-guide/" title="仕事ですぐに使えるTypeScript" target="_blank" rel="noopener">仕事ですぐに使えるTypeScript</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>Event</h2>
              <a href="https://future.connpass.com/" title="経営とITをデザインするフューチャーの勉強会です" target="_blank" rel="noopener">connpass</a><br>
              <a href="https://www.future.co.jp/futureinsightseminar/" title="フューチャーインサイトセミナー" target="_blank" rel="noopener">Webセミナー</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>SNS</h2>
              <a href="https://github.com/future-architect" title="Future's official open source repositories" target="_blank" rel="noopener">GitHub</a><br>
              <a href="https://qiita.com/organizations/future" title="フューチャーのQiita Organizationです" target="_blank" rel="noopener">Qiita</a><br>
              <a href="https://note.future.co.jp/" title="フューチャーの公式note" target="_blank" rel="noopener">未来報</a><br>
              <a href="https://www.youtube.com/channel/UCJUSwYYd0CkGgmEKAW7QVpw" title="フューチャーYoutubeチャネル" target="_blank" rel="noopener">Youtube</a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="container">
          <div class="row">
            <div class="col-md-6 col-sm-6 padding-top-10">
              &copy; 2024 フューチャー技術ブログ<br>
            </div>
          </div>
        </div>
      </div>
    </footer>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X1C28R8H0M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X1C28R8H0M');
  gtag('config', 'UA-74047147-1'); // 過渡期対応
</script>

  </div>
</body>
</html>
