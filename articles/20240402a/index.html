<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <!--
    ███████╗██╗░░░██╗████████╗██╗░░░██╗██████╗░███████╗
    ██╔════╝██║░░░██║╚══██╔══╝██║░░░██║██╔══██╗██╔════╝
    █████╗░░██║░░░██║░░░██║░░░██║░░░██║██████╔╝█████╗░░
    ██╔══╝░░██║░░░██║░░░██║░░░██║░░░██║██╔══██╗██╔══╝░░
    ██║░░░░░╚██████╔╝░░░██║░░░╚██████╔╝██║░░██║███████╗
    ╚═╝░░░░░░╚═════╝░░░░╚═╝░░░░╚═════╝░╚═╝░░╚═╝╚══════╝
    ████████╗███████╗░█████╗░██╗░░██╗
    ╚══██╔══╝██╔════╝██╔══██╗██║░░██║
    ░░░██║░░░█████╗░░██║░░╚═╝███████║
    ░░░██║░░░██╔══╝░░██║░░██╗██╔══██║
    ░░░██║░░░███████╗╚█████╔╝██║░░██║
    ░░░╚═╝░░░╚══════╝░╚════╝░╚═╝░░╚═╝
    ██████╗░██╗░░░░░░█████╗░░██████╗░
    ██╔══██╗██║░░░░░██╔══██╗██╔════╝░
    ██████╦╝██║░░░░░██║░░██║██║░░██╗░
    ██╔══██╗██║░░░░░██║░░██║██║░░╚██╗
    ██████╦╝███████╗╚█████╔╝╚██████╔╝
    ╚═════╝░╚══════╝░╚════╝░░╚═════╝░
    Welcome engineer.
    https://www.future.co.jp/recruit/
  -->
  
  <title>Difyで生成AIアプリケーション入門　前編：生成AIアプリケーションをノーコードで開発 | フューチャー技術ブログ</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
  <meta name="description" content="概要Dify （DeFiではない）と Anthropic Claude （OpenAI でも OpenRouter 経由の何かでもOK）を使って簡単に生成AIアプリケーションを構築する方法をご紹介します。  前編：ノーコードで生成AIアプリケーションを構築するチュートリアル 後編：自作プログラムで機能追加して生成AIの指向性と精度を高めるサンプル  の2本立ての予定です。 対象読者 生成AIに興味">
<meta property="og:type" content="article">
<meta property="og:title" content="Difyで生成AIアプリケーション入門　前編：生成AIアプリケーションをノーコードで開発 | フューチャー技術ブログ">
<meta property="og:url" content="https://future-architect.github.io/articles/20240402a/index.html">
<meta property="og:site_name" content="フューチャー技術ブログ">
<meta property="og:description" content="概要Dify （DeFiではない）と Anthropic Claude （OpenAI でも OpenRouter 経由の何かでもOK）を使って簡単に生成AIアプリケーションを構築する方法をご紹介します。  前編：ノーコードで生成AIアプリケーションを構築するチュートリアル 後編：自作プログラムで機能追加して生成AIの指向性と精度を高めるサンプル  の2本立ての予定です。 対象読者 生成AIに興味">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image.png">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image_2.png">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image_3.png">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image_4.png">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image_5.png">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image_6.png">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image_7.png">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image_8.png">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image_9.png">
<meta property="og:image" content="https://future-architect.github.io/images/20240402a/image_10.png">
<meta property="article:published_time" content="2024-04-01T15:00:00.000Z">
<meta property="article:modified_time" content="2024-04-04T05:12:16.537Z">
<meta property="article:tag" content="ノーコード">
<meta property="article:tag" content="生成AI">
<meta property="article:tag" content="Dify">
<meta property="article:tag" content="Anthropic Claude">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://future-architect.github.io/images/20240402a/image.png">
  
  <link rel="alternate" href="/atom.xml" title="フューチャー技術ブログ" type="application/atom+xml">
  
  <link rel="icon" href="/logo.svg" sizes="any" type="image/svg+xml">
  <link rel="mask-icon" href="/logo.svg" sizes="any" color="#0bd">
  <link rel="icon alternate" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes='180x180' href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes='57x57' href="/apple-touch-icon-57x57.png">
  <link rel="canonical" href="https://future-architect.github.io/articles/20240402a/">
  <meta content="ノーコード,生成AI,Dify,Anthropic Claude" name="keywords">
  <meta content="前川喜洋" name="author">
  <link rel="preload" as="image" href="/banner.jpg" />
  <link rel='manifest' href='/manifest.webmanifest'/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <link rel="stylesheet" href="/metronic/assets/style.css">
  <link rel="stylesheet" href="/css/theme-styles.css">
<meta name="generator" content="Hexo 5.4.2"></head>

<body class="corporate">
  <div class="wrap" itemscope itemtype="https://schema.org/TechArticle">
  <!-- BEGIN HEADER -->
<header class="header">
	<div class="header-overlay">
		<div class="header-menu"></div>
		<div class="header-title"><a href="/">Future Tech Blog</a></div>
		<div class="header-title-sub">フューチャー技術ブログ</div>
	</div>
</header>
<!-- Header END -->

  <div class="container">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/articles/">Blog</a></li>
    <li class="active">Post</li>
  </ul>
  <section id="main" class="margin-top-30">
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programmingカテゴリ</a>
  </div>


    <h2 itemprop="name" class="article-title">Difyで生成AIアプリケーション入門　前編：生成AIアプリケーションをノーコードで開発
  
  <a target="_blank" rel="noopener" href="https://github.com/future-architect/tech-blog/edit/master/source/_posts/20240402a_Difyで生成AIアプリケーション入門　前編：生成AIアプリケーションをノーコードで開発.md" title="Suggest Edits" class="github-edit"><i class="github-edit-icon"></i></a>
  
</h2>

    <div class="row">
  <main class="col-md-9 blog-posts">
    <article id="post-20240402a_Difyで生成AIアプリケーション入門　前編：生成AIアプリケーションをノーコードで開発" class="article article-type-post blog-item" itemscope itemprop="blogPost">
      <div class="article-inner">
        
        <header class="article-header">
          <ul class="blog-info">
            <li class="blog-info-item"><a href="/articles/2024/" class="publish-date"><time datetime="2024-04-01T15:00:00.000Z" itemprop="datePublished">2024.04.02</time></a>
</li>
            <li class="blog-info-item"><li><a href="/authors/%E5%89%8D%E5%B7%9D%E5%96%9C%E6%B4%8B" title="前川喜洋さんの記事一覧へ" class="post-author">前川喜洋</a></li></li>
            <li class="blog-info-item">
  
    
    <a href="/tags/ノーコード/" title="ノーコードタグの記事へ" class="tag-list-link">ノーコード</a>
  
    
    <a href="/tags/生成AI/" title="生成AIタグの記事へ" class="tag-list-link">生成AI</a>
  
    
    <a href="/tags/Dify/" title="Difyタグの記事へ" class="tag-list-link">Dify</a>
  
    
    <a href="/tags/Anthropic-Claude/" title="Anthropic Claudeタグの記事へ" class="tag-list-link">Anthropic Claude</a>
  

</li>
            <li class="blog-info-item">500 View</li>
          </ul>
          </header>
        
        <div class="article-entry" itemprop="articleBody">
          
            <h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p><a target="_blank" rel="noopener" href="https://dify.ai/">Dify</a> （DeFiではない）と <a target="_blank" rel="noopener" href="https://console.anthropic.com/dashboard">Anthropic Claude</a> （OpenAI でも OpenRouter 経由の何かでもOK）を使って簡単に生成AIアプリケーションを構築する方法をご紹介します。</p>
<ul>
<li>前編：ノーコードで生成AIアプリケーションを構築するチュートリアル</li>
<li><a href="/articles/20240404a/">後編</a>：自作プログラムで機能追加して生成AIの指向性と精度を高めるサンプル</li>
</ul>
<p>の2本立ての予定です。</p>
<h3 id="対象読者"><a href="#対象読者" class="headerlink" title="対象読者"></a>対象読者</h3><ul>
<li>生成AIに興味があるがまだチャット以上の利用法を見出せず手を出せていない方</li>
<li>お試しに手軽に生成AIアプリケーションを構築してみたい方</li>
<li>特にOpenAIに月額費用に躊躇っている方</li>
</ul>
<h3 id="前提知識・環境"><a href="#前提知識・環境" class="headerlink" title="前提知識・環境"></a>前提知識・環境</h3><ul>
<li>Docker (Docker Compose)。Windows なら Docker Desktop。後編ではホスト名 <code>host.docker.internal</code> を使用します</li>
<li>“時々生成AIをチャットで活用している”程度のプロンプト操作の知識</li>
</ul>
<h3 id="取り上げない話題"><a href="#取り上げない話題" class="headerlink" title="取り上げない話題"></a>取り上げない話題</h3><p>何が実現可能になるかを示唆する事にフォーカスするので、手段は深堀しません。例えばRAGには触れません。</p>
<h2 id="準備"><a href="#準備" class="headerlink" title="準備"></a>準備</h2><p>Anthropic API のAPIキーを取得し、Difyをローカルで起動します。</p>
<p>サービスとして提供されている <a target="_blank" rel="noopener" href="https://dify.ai/">https://dify.ai/</a> を使ってもいいですが、APIキーを預けるのは何となく不安なので＆後編で便利なのでローカルで話を進めます。</p>
<h3 id="Anthropic-API-でAPIキー取得"><a href="#Anthropic-API-でAPIキー取得" class="headerlink" title="Anthropic API でAPIキー取得"></a>Anthropic API でAPIキー取得</h3><p><a target="_blank" rel="noopener" href="https://console.anthropic.com/settings/plans">https://console.anthropic.com/settings/plans</a> で電話番号認証後の初回だけ5ドル分の無料お試し枠が貰えます。既に OpenAI や OpenRouter に課金されている方はそちらでも良いですが以下でモデルを指定する箇所では適宜読み替えてください。</p>
<p>モデルによりトークン当たりのクレジットの消費量が異なりますが、コスト軸での選択の目安は以下の通りです。</p>
<ul>
<li>Haiku：ガンガン使っても殆ど減らないので感触を探る間は当面これで</li>
<li>Sonnet：試行錯誤していると目に見えて減っていくので残高注意</li>
<li>Opus：ごっそり減るのでお試し中の常用は非推奨。比較検証したい時のワンポイントで</li>
</ul>
<p>もうAnthropicの無料枠を消化してしまった人は <a target="_blank" rel="noopener" href="https://openrouter.ai/">https://openrouter.ai/</a> が使えるかもしれません。入金しなくても謎に0.2ドル程度をタダで使わせてくれたり、仮想通貨（PolygonネットワークのUSDC）決済が出来たりします。</p>
<h3 id="Difyセットアップ"><a href="#Difyセットアップ" class="headerlink" title="Difyセットアップ"></a>Difyセットアップ</h3><h4 id="インストール"><a href="#インストール" class="headerlink" title="インストール"></a>インストール</h4><p><code>git clone https://github.com/langgenius/dify</code> するか、<a target="_blank" rel="noopener" href="https://github.com/langgenius/dify/tree/main/docker">https://github.com/langgenius/dify/tree/main/docker</a> の <code>docker-compose.yaml</code> と <code>nginx</code> ディレクトリをダウンロードして、 <code>docker-compose.yaml</code> のある場所で <code>docker compose up -d</code> します。</p>
<p>実行時のディレクトリ直下にボリュームディレクトリ <code>volumes</code> が作成されます。</p>
<p>nginx がポート <code>80</code> で起動するので空けておくか <code>services.nginx.ports</code> を適当な値に変えてください。</p>
<h4 id="初期設定"><a href="#初期設定" class="headerlink" title="初期設定"></a>初期設定</h4><p><a target="_blank" rel="noopener" href="http://localhost/">http://localhost/</a> にアクセスすると初回は「管理者アカウントの設定」画面が表示されます。メールアドレスは適当な値で大丈夫ですが次のサインイン画面で使うので何を入れたかは忘れないでください。<br>言語設定は日本語のままでもあまり不自由しませんが、ところどころ未翻訳のテキストが空欄で表示されたり <code>undefined</code> になったりしてしまうので出来れば英語の方がお勧めです。</p>
<p>サインインしたら、右上のアカウント名をクリックして設定→モデルプロバイダー→Anthropicにマウスオーバーしてセットアップ、と進んでAPIキーを入力します。そのままだとシステムモデルに Claude 3 Opus が使われてしまうので Haiku を選択します。寄稿時点では <code>claude-3-haiku-20240307</code> というモデル名でした。ここでClaudeシリーズが選択できない場合は何かしらエラーが発生しています。原因が分からなければAPIキーを再発行＆再入力してください。</p>
<img src="/images/20240402a/image.png" alt="" width="891" height="530" loading="lazy">

<p>ちなみに OpenRouter を使用するなどして OpenAI 互換のモデルを使用する場合は一番下の <code>Model providers compatible with OpenAI&#39;s API standard, such as LM Studio.</code> で使用できます。が、恐らくDifyの不具合でそれだけではモデルとして使用可能になりません。一度保存したモデル情報を開いて保存しなおすと使用可能になります。</p>
<h2 id="チュートリアル1：シンプルな生成AIチャットbot"><a href="#チュートリアル1：シンプルな生成AIチャットbot" class="headerlink" title="チュートリアル1：シンプルな生成AIチャットbot"></a>チュートリアル1：シンプルな生成AIチャットbot</h2><p>特定のテーブル定義に対して特化したSQLを生成するチャットbotを作ってみましょう。</p>
<h3 id="開発"><a href="#開発" class="headerlink" title="開発"></a>開発</h3><ol>
<li>画面上部の<a href="">スタジオ</a>→新しいアプリを作成する、をクリック。タイプにアシスタントを選択し、適当な名前を付けます。後から変更可能です。（実はおなじみのAIチャットとして使うだけならここまでで完成してしまっています）</li>
<li>画面左の「手順」に以下を入力します。フォーカスを外すと変数追加をリコメンドしてくれます。追加後このままだと短文しか入力できないので両方 ⚙ で「段落」に変更します。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">You can behave as an expert of database expert. Provide a clear answer to the main purpose of the order. Omit preamble, phase, and repeating the order.</span><br><span class="line"></span><br><span class="line">DDL:</span><br><span class="line">```</span><br><span class="line">&#123;&#123;DDL&#125;&#125;</span><br><span class="line">```</span><br><span class="line">Data model descriptions:</span><br><span class="line">```</span><br><span class="line">&#123;&#123;DataModelDescriptions&#125;&#125;</span><br><span class="line">```</span><br></pre></td></tr></table></figure>

<img src="/images/20240402a/image_2.png" alt="" width="873" height="321" loading="lazy">
<img src="/images/20240402a/image_3.png" alt="" width="768" height="465" loading="lazy">

<h3 id="動作確認"><a href="#動作確認" class="headerlink" title="動作確認"></a>動作確認</h3><ol>
<li>ここで画面右上の「公開」をクリックしてください。しなくても動作確認は出来ますが、変更が保存されていません。実はこの時点で完成したアプリケーションとして公開されてしまいますが、これ以外に開発中のアプリケーションを保存する方法が見当たりませんでした。</li>
<li><code>DDL</code> に <code>CREATE TABLE ~</code> などのDDLを貼り付けてください。<br><code>DataModelDescriptions</code> に各テーブルの内容や結合方式などについての説明文を貼り付けてください。必須ではありませんがこれが無いとAIはすぐ存在しないカラムの幻覚を見始めるので強く推奨します。<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup><br>（ここで入力した値は永続化されないので、何度も使い回す用に自分でテキストファイルにでも貼り付けて保存しておきましょう）</li>
<li>画面右下に薄っすらと入力欄が有るのでそこにSQL生成を依頼するプロンプトを入力してください。</li>
<li>速い安い旨いの Haiku でも3，4テーブル程度の結合・集約なども結構な高精度で生成してくれます。</li>
</ol>
<img src="/images/20240402a/image_4.png" alt="" width="914" height="862" loading="lazy">

<p>参考までに私が使用した変数の値を下記に貼り付けておきます。少し実務みのある区分値やリレーションを設定してあります。</p>
<details><summary>DDL</summary>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- Project Name : retail</span></span><br><span class="line"><span class="comment">-- Date/Time    : 2024/03/22 金 22:25:09</span></span><br><span class="line"><span class="comment">-- Author       : </span></span><br><span class="line"><span class="comment">-- RDBMS Type   : PostgreSQL</span></span><br><span class="line"><span class="comment">-- Application  : A5:SQL Mk-2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  &lt;&lt; 注意！！ &gt;&gt;</span></span><br><span class="line"><span class="comment">  BackupToTempTable, RestoreFromTempTable疑似命令が付加されています。</span></span><br><span class="line"><span class="comment">  これにより、drop table, create table 後もデータが残ります。</span></span><br><span class="line"><span class="comment">  この機能は一時的に $$TableName のような一時テーブルを作成します。</span></span><br><span class="line"><span class="comment">  この機能は A5:SQL Mk-2でのみ有効であることに注意してください。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 売上</span></span><br><span class="line"><span class="comment">-- * BackupToTempTable</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> sale cascade;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- * RestoreFromTempTable</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sale (</span><br><span class="line">  id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , palce_id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , product_id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , selling_price_ID <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , business_date <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , sales_at <span class="type">timestamp</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , transfer_id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , discount_amount <span class="type">integer</span></span><br><span class="line">  , sales_amount <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , <span class="keyword">constraint</span> sale_PKC <span class="keyword">primary</span> key (id)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 移動</span></span><br><span class="line"><span class="comment">-- * BackupToTempTable</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> transfer cascade;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- * RestoreFromTempTable</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> transfer (</span><br><span class="line">  id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , place_id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , product_id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , business_date <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , transfer_at <span class="type">timestamp</span></span><br><span class="line">  , transfer_classification <span class="type">character</span> <span class="type">varying</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , transfer_quantity <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , transfer_destination_classification <span class="type">character</span> <span class="type">varying</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , transfer_destination_place_id <span class="type">integer</span></span><br><span class="line">  , <span class="keyword">constraint</span> transfer_PKC <span class="keyword">primary</span> key (id)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在庫</span></span><br><span class="line"><span class="comment">-- * BackupToTempTable</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> stock cascade;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- * RestoreFromTempTable</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stock (</span><br><span class="line">  place_id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , product_id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , business_date <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , stock_quantity <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , <span class="keyword">constraint</span> stock_PKC <span class="keyword">primary</span> key (place_id,product_id,business_date)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> index stock_IX1</span><br><span class="line">  <span class="keyword">on</span> stock(product_id,business_date);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 売価</span></span><br><span class="line"><span class="comment">-- * BackupToTempTable</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> selling_price cascade;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- * RestoreFromTempTable</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> selling_price (</span><br><span class="line">  id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , product_id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , selling_price_classification <span class="type">character</span> <span class="type">varying</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , start_date <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , end_date <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , selling_price <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , <span class="keyword">constraint</span> selling_price_PKC <span class="keyword">primary</span> key (id)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> index selling_price_IX1</span><br><span class="line">  <span class="keyword">on</span> selling_price(product_id,selling_price_classification);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 場所</span></span><br><span class="line"><span class="comment">-- * BackupToTempTable</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> place cascade;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- * RestoreFromTempTable</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> place (</span><br><span class="line">  id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , place_name <span class="type">character</span> <span class="type">varying</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , selling_price_classification <span class="type">character</span> <span class="type">varying</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , <span class="keyword">constraint</span> place_PKC <span class="keyword">primary</span> key (id)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 商品</span></span><br><span class="line"><span class="comment">-- * BackupToTempTable</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> product cascade;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- * RestoreFromTempTable</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> product (</span><br><span class="line">  id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , product_name <span class="type">character</span> <span class="type">varying</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">  , <span class="keyword">constraint</span> product_PKC <span class="keyword">primary</span> key (id)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> sale <span class="keyword">is</span> <span class="string">&#x27;売上&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> sale.id <span class="keyword">is</span> <span class="string">&#x27;ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> sale.palce_id <span class="keyword">is</span> <span class="string">&#x27;場所ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> sale.product_id <span class="keyword">is</span> <span class="string">&#x27;商品ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> sale.selling_price_ID <span class="keyword">is</span> <span class="string">&#x27;売価ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> sale.business_date <span class="keyword">is</span> <span class="string">&#x27;業務日付&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> sale.sales_at <span class="keyword">is</span> <span class="string">&#x27;売上日時&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> sale.transfer_id <span class="keyword">is</span> <span class="string">&#x27;入出荷ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> sale.discount_amount <span class="keyword">is</span> <span class="string">&#x27;値引額&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> sale.sales_amount <span class="keyword">is</span> <span class="string">&#x27;売上金額&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> transfer <span class="keyword">is</span> <span class="string">&#x27;移動&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> transfer.id <span class="keyword">is</span> <span class="string">&#x27;ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> transfer.place_id <span class="keyword">is</span> <span class="string">&#x27;場所ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> transfer.product_id <span class="keyword">is</span> <span class="string">&#x27;商品ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> transfer.business_date <span class="keyword">is</span> <span class="string">&#x27;業務日付&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> transfer.transfer_at <span class="keyword">is</span> <span class="string">&#x27;移動日時&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> transfer.transfer_classification <span class="keyword">is</span> <span class="string">&#x27;入出荷区分:1:入荷、2:出荷&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> transfer.transfer_quantity <span class="keyword">is</span> <span class="string">&#x27;移動数&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> transfer.transfer_destination_classification <span class="keyword">is</span> <span class="string">&#x27;移動先区分:1:場所間移動、2:売上、3:仕入&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> transfer.transfer_destination_place_id <span class="keyword">is</span> <span class="string">&#x27;移動先場所ID&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> stock <span class="keyword">is</span> <span class="string">&#x27;在庫&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> stock.place_id <span class="keyword">is</span> <span class="string">&#x27;場所ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> stock.product_id <span class="keyword">is</span> <span class="string">&#x27;商品ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> stock.business_date <span class="keyword">is</span> <span class="string">&#x27;業務日付&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> stock.stock_quantity <span class="keyword">is</span> <span class="string">&#x27;在庫数&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> selling_price <span class="keyword">is</span> <span class="string">&#x27;売価&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> selling_price.id <span class="keyword">is</span> <span class="string">&#x27;ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> selling_price.product_id <span class="keyword">is</span> <span class="string">&#x27;商品ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> selling_price.selling_price_classification <span class="keyword">is</span> <span class="string">&#x27;売価区分:区分値： 1:プロパー, 2:B品, 3:アウトレット, 4:催事&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> selling_price.start_date <span class="keyword">is</span> <span class="string">&#x27;適用開始日&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> selling_price.end_date <span class="keyword">is</span> <span class="string">&#x27;適用終了日&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> selling_price.selling_price <span class="keyword">is</span> <span class="string">&#x27;売価&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> place <span class="keyword">is</span> <span class="string">&#x27;場所&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> place.id <span class="keyword">is</span> <span class="string">&#x27;ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> place.place_name <span class="keyword">is</span> <span class="string">&#x27;場所名&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> place.selling_price_classification <span class="keyword">is</span> <span class="string">&#x27;売価区分:区分値： 1:プロパー, 2:B品, 3:アウトレット, 4:催事&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> product <span class="keyword">is</span> <span class="string">&#x27;商品&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> product.id <span class="keyword">is</span> <span class="string">&#x27;ID&#x27;</span>;</span><br><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> product.product_name <span class="keyword">is</span> <span class="string">&#x27;商品名&#x27;</span>;</span><br></pre></td></tr></table></figure>
</details>

<details><summary>Data Model Descriptions</summary>

<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># データモデル概要</span></span><br><span class="line"></span><br><span class="line"><span class="section">## 売価テーブル ( `selling<span class="emphasis">_price` )</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 売価は商品別・売価区分別・業務日付別に登録される。但し業務日付は日々ではなく開始日～終了日の範囲指定で登録される。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 売価区分にはプロパー・B品・アウトレット・催事の4種類がある。つまり商品ごとに最大で4つの売価が設定されうる。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 売価区分の定義は以下の通り。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">  </span></span></span><br><span class="line"><span class="emphasis"><span class="section">| 売価区分 | 意味 |</span></span></span><br><span class="line"><span class="emphasis"><span class="section">| - | - |</span></span></span><br><span class="line"><span class="emphasis"><span class="section">| プロパー | 発売当初の定価 |</span></span></span><br><span class="line"><span class="emphasis"><span class="section">| B品 | 傷物など、商品個体の不具合により販売場所（以下「売場」と呼ぶ）の判断で値下げを要する場合の売価 |</span></span></span><br><span class="line"><span class="emphasis"><span class="section">| アウトレット | 商品のターゲットシーズンを過ぎて値下げした後の売価 |</span></span></span><br><span class="line"><span class="emphasis"><span class="section">| 催事 | 催事場で使用される特別売価 |</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">## 場所テーブル( `place` )</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 場所テーブルには場所の名前と標準の売価区分が登録されている。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 場所に設定されている売価区分によって、その場所で発生しうる売上の売価区分が制限される。組み合わせは以下の通り。</span></span></span><br><span class="line"><span class="emphasis"><span class="section"> </span></span></span><br><span class="line"><span class="emphasis"><span class="section">| 場所の売価区分 | 売上として発生しうる売価区分 |</span></span></span><br><span class="line"><span class="emphasis"><span class="section">| - | - |</span></span></span><br><span class="line"><span class="emphasis"><span class="section">| プロパー | プロパー・B品・アウトレット |</span></span></span><br><span class="line"><span class="emphasis"><span class="section">| アウトレット | プロパー・B品・アウトレット |</span></span></span><br><span class="line"><span class="emphasis"><span class="section">| 催事 | プロパー・催事 |</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 場所の売価区分としてB品は選択できない。</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">## 移動テーブル( `transfer` )</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 移動テーブルにはある場所で発生した商品の入出荷情報が全て登録される。仕入による入荷、販売による出荷、場所間での移動による入荷/出荷など。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 場所間で発生した移動の場合、</span></span></span><br><span class="line"><span class="emphasis"><span class="section">  * 移動元の場所において出荷、移動先の場所において入荷のレコードが登録される。互いのレコードの移動数は一致する。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">  * 移動先場所IDカラムに移動先の場所IDが登録される。</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">## 在庫テーブル( `stock` )</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 在庫テーブルには日々の当初の場所別・商品別の在庫数が記録される。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 移動テーブルに全ての入出荷情報が登録されているため、ある日の在庫レコードの在庫数は `前日の在庫レコードの在庫数 + 前日の移動テーブルの入荷分の移動数の合計 - 前日の移動テーブルの出荷分の移動数の合計` と一致する。</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">## 売上テーブル( `sale` )</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 売上テーブルには場所別・商品別・売価別の売上情報が登録される。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 売上の登録に際して必要な入力値は場所ID・商品ID・売価区分・売上数・値引額の4個。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 売上数は売上テーブル上では管理しない。売上の発生に伴い移動テーブルに入出荷区分：出荷、移動先区分：売上、移動数：売上数のレコードが登録される。そのレコードのIDが売上レコードの移動IDカラムに保持される。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 売価区分は売上を登録する時点で任意に選択される。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">  * 但し、その売場に該当する場所テーブル上の売価区分の設定値により、取り得る売価区分は制限される。詳細は場所テーブルの項を参照。</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 販売した商品の売上金額は、登録時の入力値に従って次のように計算されて登録される: `売価 * 移動数 - 値引額`</span></span></span><br><span class="line"><span class="emphasis"><span class="section">* 売価は売価テーブルより `適用開始日 &lt;= 業務日付 &lt;= 適用終了日` の条件で取得する。</span></span></span><br></pre></td></tr></table></figure>
</details>

<p>プロンプト：「売上金額と売上数を場所別・商品別・月別に集計するSQL」</p>
<h3 id="アプリケーション公開"><a href="#アプリケーション公開" class="headerlink" title="アプリケーション公開"></a>アプリケーション公開</h3><p>ここまでの操作で（公開をクリックした時点で）既にDify上で動作するアプリケーションが完成し公開されています。<br>画面左のメニューで「概要」で下記の画面が表示されます。UIもAPIも使用可能な上にAPIキー管理機能まで自動で提供されていてまさに至れり尽くせり。プレビューをクリックするとアプリケーションの画面が開きます。</p>
<img src="/images/20240402a/image_5.png" alt="" width="632" height="519" loading="lazy">
<img src="/images/20240402a/image_6.png" alt="" width="795" height="562" loading="lazy">

<h2 id="チュートリアル2：外部ツールの使用"><a href="#チュートリアル2：外部ツールの使用" class="headerlink" title="チュートリアル2：外部ツールの使用"></a>チュートリアル2：外部ツールの使用</h2><p>文章を生成するだけのLLMに、外部サイトの情報を収集する機能と、グラフを描画する機能を追加します。</p>
<h3 id="開発-1"><a href="#開発-1" class="headerlink" title="開発"></a>開発</h3><ol>
<li>また画面上部のメニューからスタジオ→新しいアプリを作成する→アシスタントを選択して適当な名前で作成してください。</li>
<li>「基本アシスタント」をクリックして「エージェントアシスタント」を選択します。<img src="/images/20240402a/image_7.png" alt="" width="465" height="337" loading="lazy"></li>
<li>画面左側に「ツール」エリアが出現するので、「＋追加」をクリックして、 Wikipedia と ChartGenerator の Pie Chart を追加します。<img src="/images/20240402a/image_8.png" alt="" width="1157" height="644" loading="lazy"></li>
<li>「手順」に <code>ユーザの入力したプロンプトについてWikipediaで検索し、数値の情報をもとにパイチャートを作成してください。</code> と入力します。無くても動作はしますがそのままだと LLM が Wikipedia を参照せず手持ちの情報で回答してしまいがちなので念を押しておきます。</li>
</ol>
<h3 id="動作確認-1"><a href="#動作確認-1" class="headerlink" title="動作確認"></a>動作確認</h3><p>「公開」をクリックしてプロンプトに「アメリカの全人口における州ごとの人口のパイチャート」と入力すると若干怪しい動きを見せつつ作図されます。<br><img src="/images/20240402a/image_9.png" alt="" width="510" height="692" loading="lazy"></p>
<p>実は残念ながら現時点では Anthropic の Functions &amp; external tools には直接対応していないらしく、エージェント設定を見るとエージェントモードが ReAct になっています（GPTやGPT互換だと Function Calling のはず）。どうもこの場合Difyは、「LLMが生成した文字列からツール用パラメータっぽい部分をパースしてツールに中継する」という形で Function Calling を模した機能を提供するようで、生成された文字列が一部でもJSONとして破綻（値の中で改行など）していると失敗します。ツールの呼び出しに失敗するとツールを呼び出そうとした文字列がそのまま最終回答文として出力されます。</p>
<img src="/images/20240402a/image_10.png" alt="" width="437" height="358" loading="lazy">
<img src="/images/20240402a/image_11.png" alt="" width="603" height="603" loading="lazy">

<h2 id="後編に続く"><a href="#後編に続く" class="headerlink" title="後編に続く"></a>後編に続く</h2><p>前編では下記のステップを辿りました。</p>
<ul>
<li>チャットbotに手順(Instruction)を与えて特定の問題領域に特化したチャットbotを作る</li>
<li>既製のToolを使用して自然言語処理以外の機能を獲得する</li>
</ul>
<p><a href="/articles/20240404a/">後編</a>はこれらを進めて以下の内容を書きます。</p>
<ul>
<li>Toolを自作して機能を拡張する</li>
<li>生成AIに自分の生成した回答を自己レビューさせる</li>
</ul>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="vertical-align: top; padding-right: 10px;">1.</span><span style="vertical-align: top;">RAG用テキストやベクトルデータベースを作る場合にも言えますが、生成AIに前提知識を与える時には詳細な情報に加えてその概要と補足情報などで多面的に与えると精度が上がります。単純に手軽さだけで言えば、データのフォーマットの工夫に腐心するより表現のバリエーションを増やす方が楽です。パケ死ならぬトークン死しますが…</span><a href="#fnref:1" rev="footnote"> ↩</a></li></ol></div></div>
          
        </div>
        <footer>
          <section class="social-area">
          <!-- シェアボタン START -->
  <ul class="social-button">
    
    <!-- Twitter -->
    <li>
      <a class="social-btn twitter-btn" target="_blank" href="https://twitter.com/intent/tweet?url=https://future-architect.github.io/articles/20240402a/&related=twitterapi%2Ctwitter&text=Dify%E3%81%A7%E7%94%9F%E6%88%90AI%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%85%A5%E9%96%80%E3%80%80%E5%89%8D%E7%B7%A8%EF%BC%9A%E7%94%9F%E6%88%90AI%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E3%83%8E%E3%83%BC%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A7%E9%96%8B%E7%99%BA%20%7C%20%E3%83%95%E3%83%A5%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E6%8A%80%E8%A1%93%E3%83%96%E3%83%AD%E3%82%B0" rel="nofollow noopener">
        <i></i><span class="social-btn-label">ツイート</span>
      </a>
    </li>
    <!-- Facebook -->
    <li>
      <a class="social-btn fb-btn" target="_blank" href="http://www.facebook.com/share.php?u=https://future-architect.github.io/articles/20240402a/&t=Dify%E3%81%A7%E7%94%9F%E6%88%90AI%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%85%A5%E9%96%80%E3%80%80%E5%89%8D%E7%B7%A8%EF%BC%9A%E7%94%9F%E6%88%90AI%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E3%83%8E%E3%83%BC%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A7%E9%96%8B%E7%99%BA" rel="nofollow noopener">
        <i></i><span class="social-btn-label">シェア</span>
      </a>
    </li>
    <!-- hatebu -->
    <li>
      <a class="social-btn hatebu-btn" target="_blank" href="https://b.hatena.ne.jp/entry/s/future-architect.github.io/articles/20240402a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">1</span>
      </a>
    </li>
    <!-- pocket -->
    <li>
      <a class="social-btn pocket-btn" target="_blank" href="https://getpocket.com/save?url=https://future-architect.github.io/articles/20240402a/" rel="nofollow noopener">
        <i></i><span class="social-btn-label">4</span>
      </a>
    </li>
    
  </ul>
<!-- シェアボタン END -->

          </section>
          <aside>
            <section class="related-post margin-bottom-40 nav">
              <h2 id="related"><a href="#related" class="headerlink" title="関連記事"></a>関連記事</h2>
              
  <div class="widget">
    <ul class="nav related-post-link"><li class="related-posts-item"><span>2024.04.04</span><span class="snscount">&#9825;1</span><a href=/articles/20240404a/ title="前編のチュートリアル1で作ったSQL生成チャットbotをベースに、セルフレビュー機能を追加し、間違ったSQL文や存在しないテーブルやカラムを使用しようとした時に自動でやり直すように改修します。">Difyで生成AIアプリケーション入門　後編：自作プログラムで機能追加して生成AIの指向性と精度を高める<span class="newitem">NEW</span></a></li><li class="related-posts-item"><span>2024.02.27</span><span class="snscount">&#9825;6</span><a href=/articles/20240227a/ title="この認証プロキシを利用する際には、ユーザ名とパスワードの入力が必要であり、ソフトウェアごとにプロキシ設定を行う必要があります。これが、日々の業務において非常に煩わしい作業となっています。">ローカルプロキシで認証プロキシの煩わしさを解消！</a></li><li class="related-posts-item"><span>2023.05.09</span><span class="snscount">&#9825;2</span><a href=/articles/20230509a/ title="2023/03/07から一般提供が開始された新サービス「AWS Application Composer」を使ってみて、どんな人向けか、強み・弱みは何かというところを見ていきます。">AWS Application Composerを使ってみた！</a></li><li class="related-posts-item"><span>2022.03.25</span><span class="snscount">&#9825;22</span><a href=/articles/20220325a/ title="Flutter連載6回目としてFlutterFlowについて調べてみました。GoogleI/O'21でFlutterFlowというFlutterのノーコードのサービスが発表されました。">FlutterFlowを触ってみる</a></li><li class="related-posts-item"><span>2021.11.09</span><span class="snscount">&#9825;16</span><a href=/articles/20211109a/ title="秋のブログ週間連載の9日目として、仮想通貨の個人ウォレットのセキュリティの考え方についてお届けします。仮想通貨の存在は、2017年から2018年にかけてのビットコインの暴騰と暴落のニュースを経てもまだまだ「そういう金融商品がある」「取引所を介して売買ができる為替みたいな物」程度の認識でしか一般には浸透していませんでした。ここ1，2年でDeFi（分散型金融）、NFT、GameFiなどの関連市場やエルサルバドルの法定通貨にビットコイン採用といったホットな話題が多数立ち上がり、いよいよ腰を上げて探りを入れ始めたという方も多いのではないでしょうか。">仮想通貨の個人ウォレットの守り方</a></li><li class="related-posts-item"><span>2017.04.14</span><span class="snscount">&#9825;4</span><a href=/articles/20170414/ title="Elixir Conf Japan 2017 参加レポート">Elixir Conf Japan 2017 参加レポート</a></li></ul>
  </div>
            </section>
            <section class="reference-post margin-bottom-40 nav">
              
  <div class="card">
    <div id="reference" class="reference-lede"><a href="#reference" class="headerlink" title="参照されている記事"></a>この記事を参照している記事</div>
    <ul class="reference-post-link"><li class="reference-posts-item"><a href=/articles/20240404a/ title="前編のチュートリアル1で作ったSQL生成チャットbotをベースに、セルフレビュー機能を追加し、間違ったSQL文や存在しないテーブルやカラムを使用しようとした時に自動でやり直すように改修します。">Difyで生成AIアプリケーション入門　後編：自作プログラムで機能追加して生成AIの指向性と精度を高める<span class="newitem">NEW</span></a></li></ul>
  </div>
            </section>
          </aside>
        </footer>
      </div>
    </article>
  </main>
  <aside class="col-md-3 blog-sidebar">
    <!-- START SIDEBAR  -->


<section class="toc-section">
  <h2 class="margin-top-30">目次</h2>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%A6%81"><span class="toc-text">概要</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BE%E8%B1%A1%E8%AA%AD%E8%80%85"><span class="toc-text">対象読者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E7%9F%A5%E8%AD%98%E3%83%BB%E7%92%B0%E5%A2%83"><span class="toc-text">前提知識・環境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E3%82%8A%E4%B8%8A%E3%81%92%E3%81%AA%E3%81%84%E8%A9%B1%E9%A1%8C"><span class="toc-text">取り上げない話題</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%96%E5%82%99"><span class="toc-text">準備</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Anthropic-API-%E3%81%A7API%E3%82%AD%E3%83%BC%E5%8F%96%E5%BE%97"><span class="toc-text">Anthropic API でAPIキー取得</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dify%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><span class="toc-text">Difyセットアップ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><span class="toc-text">インストール</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E6%9C%9F%E8%A8%AD%E5%AE%9A"><span class="toc-text">初期設定</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB1%EF%BC%9A%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AA%E7%94%9F%E6%88%90AI%E3%83%81%E3%83%A3%E3%83%83%E3%83%88bot"><span class="toc-text">チュートリアル1：シンプルな生成AIチャットbot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%96%8B%E7%99%BA"><span class="toc-text">開発</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><span class="toc-text">動作確認</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%85%AC%E9%96%8B"><span class="toc-text">アプリケーション公開</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB2%EF%BC%9A%E5%A4%96%E9%83%A8%E3%83%84%E3%83%BC%E3%83%AB%E3%81%AE%E4%BD%BF%E7%94%A8"><span class="toc-text">チュートリアル2：外部ツールの使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%96%8B%E7%99%BA-1"><span class="toc-text">開発</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D-1"><span class="toc-text">動作確認</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%8C%E7%B7%A8%E3%81%AB%E7%B6%9A%E3%81%8F"><span class="toc-text">後編に続く</span></a></li></ol>
</section>

<section class="category">
<h2 class="margin-top-30">カテゴリー</h2>
<div class="widget">
  <ul class="nav sidebar-categories margin-bottom-40">
  
  <li class=""><a href="/categories/Programming/">Programming (449)</a></li>
<li class=""><a href="/categories/Infrastructure/">Infrastructure (269)</a></li>
<li class=""><a href="/categories/Culture/">Culture (100)</a></li>
<li class=""><a href="/categories/DataScience/">DataScience (63)</a></li>
<li class=""><a href="/categories/IoT/">IoT (35)</a></li>
<li class=""><a href="/categories/DB/">DB (25)</a></li>
<li class=""><a href="/categories/DevOps/">DevOps (23)</a></li>
<li class=""><a href="/categories/%E8%AA%8D%E8%A8%BC%E8%AA%8D%E5%8F%AF/">認証認可 (21)</a></li>
<li class=""><a href="/categories/Business/">Business (21)</a></li>
<li class=""><a href="/categories/Management/">Management (17)</a></li>
<li class=""><a href="/categories/Security/">Security (15)</a></li>
<li class=""><a href="/categories/VR/">VR (13)</a></li>
<li class=""><a href="/categories/Design/">Design (11)</a></li>

  </ul>
</div>

</section>
<section class="podcast-link">
<h2 class="margin-top-30">Tech Cast</h2>

  <div class="class="widget-wrap">
  <div class="widget">
    <ul class="nav techcast">
      
    </ul>
  </div>
  </div>
  
</section>
<section class="advent-calendar">
<h2 class="margin-top-30">アドベントカレンダー</h2>
<div class="widget">
  <ul class="nav-flex">
    <li><a href="http://qiita.com/advent-calendar/2023/future" title="フューチャー Advent Calendar 2023 #Qiita" target="_blank" rel="noopener">2023年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2022/future" title="フューチャー Advent Calendar 2022 #Qiita" target="_blank" rel="noopener">2022年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2021/future" title="フューチャー Advent Calendar 2021 #Qiita" target="_blank" rel="noopener">2021年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2020/future" title="フューチャー Advent Calendar 2020 #Qiita" target="_blank" rel="noopener">2020年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2019/future" title="フューチャー Advent Calendar 2019 #Qiita" target="_blank" rel="noopener">2019年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2018/future" title="フューチャー Advent Calendar 2018 #Qiita" target="_blank" rel="noopener">2018年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2017/future" title="フューチャー Advent Calendar 2017 #Qiita" target="_blank" rel="noopener">2017年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2016/future" title="フューチャー Advent Calendar 2016 #Qiita" target="_blank" rel="noopener">2016年</a></li>
    <li><a href="http://qiita.com/advent-calendar/2015/future" title="フューチャー Advent Calendar 2015 #Qiita" target="_blank" rel="noopener">2015年</a></li>
  </ul>
</div>

</section>
<!-- END SIDEBAR -->

  </aside>
</div>

  </section>
</div>

      <!-- BEGIN PRE-FOOTER -->
    <footer>
      <div class="pre-footer">
        <div class="container">
          <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>About Us</h2>
              <p>経営とITをデザインする、フューチャーの技術ブログです。業務で利用している幅広い技術について紹介します。<br /><br /><a target="_blank" rel="noopener" href="http://www.future.co.jp/">http://www.future.co.jp/</a></p>
              <div class="social-btn twitter-btn twitter-follow-btn">
                <a href="https://twitter.com/intent/follow?screen_name=future_techblog " target="_blank" rel="nofollow noopener">
                  <i></i><span class="tw-btn-label">フューチャー技術ブログをフォロー</span>
                </a>
              </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 col-4 pre-footer-col">
              <h2>Contact</h2>
              <address class="margin-bottom-40">
                <a href="https://www.future.co.jp/recruit/recruit/rec-fresh/" title="新卒採用" target="_blank" rel="noopener">新卒採用</a><br>
                <a href="https://www.future.co.jp/recruit/recruit/rec-career/" title="キャリア採用" target="_blank" rel="noopener">キャリア採用</a><br>
                <a href="https://www.future.co.jp/contact_us/" title="お問い合わせページ" target="_blank" rel="noopener">お問い合わせ</a><br>
                <a href="https://www.future.co.jp/architect/socialmediapolicy/" title="ソーシャルメディアポリシー" target="_blank" rel="noopener">メディアポリシー</a><br><br>
                <a href="mailto:techblog@future.co.jp">techblog@future.co.jp</a>
              </address>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 col-6 pre-footer-col">
              <h2>Contents</h2>
              <a href="https://future-architect.github.io/coding-standards/" title="Future Enterprise Coding Standards" target="_blank" rel="noopener">コーディング規約</a><br>
              <a href="https://future-architect.github.io/typescript-guide/" title="仕事ですぐに使えるTypeScript" target="_blank" rel="noopener">仕事ですぐに使えるTypeScript</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>Event</h2>
              <a href="https://future.connpass.com/" title="経営とITをデザインするフューチャーの勉強会です" target="_blank" rel="noopener">connpass</a><br>
              <a href="https://www.future.co.jp/futureinsightseminar/" title="フューチャーインサイトセミナー" target="_blank" rel="noopener">Webセミナー</a><br>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-3 col-3 pre-footer-col">
              <h2>SNS</h2>
              <a href="https://github.com/future-architect" title="Future's official open source repositories" target="_blank" rel="noopener">GitHub</a><br>
              <a href="https://qiita.com/organizations/future" title="フューチャーのQiita Organizationです" target="_blank" rel="noopener">Qiita</a><br>
              <a href="https://note.future.co.jp/" title="フューチャーの公式note" target="_blank" rel="noopener">未来報</a><br>
              <a href="https://www.youtube.com/channel/UCJUSwYYd0CkGgmEKAW7QVpw" title="フューチャーYoutubeチャネル" target="_blank" rel="noopener">Youtube</a>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="container">
          <div class="row">
            <div class="col-md-6 col-sm-6 padding-top-10">
              &copy; 2024 フューチャー技術ブログ<br>
            </div>
          </div>
        </div>
      </div>
    </footer>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X1C28R8H0M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X1C28R8H0M');
  gtag('config', 'UA-74047147-1'); // 過渡期対応
</script>

  </div>
</body>
</html>
